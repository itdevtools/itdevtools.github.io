!function(){"use strict";var e,t,a,s=Laya.ClassUtils.regClass;!function(e){class t extends Laya.View{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("FriendRankItemView")}}e.FriendRankItemViewUI=t,s("ui.FriendRankItemViewUI",t);class a extends Laya.View{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("FriendRankScene")}}e.FriendRankSceneUI=a,s("ui.FriendRankSceneUI",a);class n extends Laya.View{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("GameScene")}}e.GameSceneUI=n,s("ui.GameSceneUI",n);class i extends Laya.View{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("LevelUpScene")}}e.LevelUpSceneUI=i,s("ui.LevelUpSceneUI",i);class r extends Laya.View{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("RecoverScene")}}e.RecoverSceneUI=r,s("ui.RecoverSceneUI",r);class o extends Laya.View{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("StartScene")}}e.StartSceneUI=o,s("ui.StartSceneUI",o)}(e||(e={}));class n{}n.VERSION="1.0.0",n.URL_ENCOURAGE_CFG="http://itdevtools.gitee.io/games/paint_hit/encourage_cfg.json",n.URL_CPA="",n.URL_MORE_GAME="",n.URL_FLOAT_GAME="",n.REWARDED_VIDEOAD_ID="",n.BANNER_IDS=[],n.URL_3D_SCENE="res/scenes3D/LayaScene_Scene/Conventional/Scene.ls",n.URL_3D_MAT="res/scenes3D/LayaScene_Mat/Conventional/Mat.lh",n.URL_3D_Cylinder="res/scenes3D/LayaScene_Cylinder/Conventional/Cylinder.lh",n.URL_3D_Sector="res/scenes3D/LayaScene_Sector/Conventional/Sector.lh",n.URL_3D_Ball="res/scenes3D/LayaScene_Ball/Conventional/Ball.lh",n.AUDIO_BGM="res/audio/bgm.mp3",n.AUDIO_HITDIE="res/audio/se_ballhitdie.mp3",n.AUDIO_LEVELUP_DIE="res/audio/se_levelup.mp3",n.AUDIO_STAGEFINISH="res/audio/se_stagefinish.mp3",n.URL_LEVEL="res/json/level.json",n.URL_BG0="bg/0.png",n.URL_BGS=[n.URL_BG0],n.URL_COMP="res/atlas/comp.atlas",n.RECOVER_REQ_GEM_NUM=5,n.CYINLINDER_ADD_SCORE_LIMIT=10,n.HIT_GEM_DOUBLE_SCORE=2,n.PLAT_SWITCH={IS_CREATE_USERINFO_BUTTON:0,SHOW_BANNER_AD_HOMESCENE:0,SHOW_BANNER_AD_GAMESCENE:0,SHOW_BANNER_AD_RECOVERSCENE:0,SHOW_BANNER_AD_GAMESCENE_RATE:0,SHOW_BANNER_AD_LEVEL_UP_SCENESCENE:0,SHOW_BANNER_AD_FRIEND_RANKSCENE:0,SHOW_INS_AD_LEVEL_UPSCENE:0,SHOW_INS_AD_LEVEL_UPSCENE_RATE:0,SHOW_REWARD_VIDEO_AD:0,USE_SHARE_TO_REVIVE:0,USE_VIDEO_TO_REVIVE:0},function(e){e.DEV="dev",e.WEB="web",e.WX="wx",e.QQ="qq"}(t||(t={}));class i{}i.EN_US="en",i.CN="cn",i.JP="jp";class r{}r.IS_DEBUG=!1,r.SHOW_LOG=!0,r.SHOW_LOG_TO_SCREEN=!1,r.PLATFORM_TYPE=t.DEV,r.LANGUAGE=i.EN_US,r.PVP_ANS_ANI_COST_TIME=2500,r.PVP_ANS_TYPE_ANI_COST_TIME=2100,r.KNOCKOUT_ANS_ANI_COST_TIME=2500,r.rewardedVideoAdId="",r.ShareInfo={title:"球球向上",imageUrl:"share_img.png"};class o{static show(e){let t=new Laya.Image("comp/img_tixing.png");t.zOrder=1e3,t.sizeGrid="0,125,0,125",Laya.stage.addChild(t);let a=new Laya.Label(e);a.fontSize=40,a.color="#ffffff",a.stroke=5,a.strokeColor="#000000",t.addChild(a);a.centerX=0,a.centerY=0,t.width=Math.max(a.width+100,600),t.height=a.height+20,t.centerX=0,t.y=Laya.stage.height/2,(new Laya.Tween).to(t,{y:t.y-500,alpha:.2},2e3,null,Laya.Handler.create(this,()=>{t.destroy(),t=null,a.destroy(),a=null}))}static fixedDisplay(e){let t=new Laya.Image("comp/img_tixing.png");t.alpha=.85,t.zOrder=1e3,t.sizeGrid="0,125,0,125",Laya.stage.addChild(t);let a=new Laya.Label(e);a.fontSize=40,a.color="#ffffff",a.stroke=5,a.strokeColor="#000000",t.addChild(a);a.centerX=0,a.centerY=0,t.width=Math.max(a.width+100,600),t.height=a.height+20,t.centerX=0,t.y=Laya.stage.height/2,(new Laya.Tween).to(t,{},2e3,null,Laya.Handler.create(this,()=>{t.destroy(),t=null,a.destroy(),a=null}))}static debugShow(e){let t=new Laya.Label(e);t.width=Laya.stage.width,t.wordWrap=!0,t.fontSize=20,t.color="#000000";let a=o.debugMsgArray[o.debugMsgArray.length-1];o.debugMsgArray.push(t),t.y=a?a.y+a.height+18:100,t.zOrder=1e3,Laya.stage.addChild(t)}}o.debugMsgArray=new Array,function(e){e[e.NONE=0]="NONE",e[e.SINGLE=1]="SINGLE",e[e.ALL=2]="ALL"}(a||(a={}));var l,c,h,d,_,u={VERSION:"v{0}",COMMON_NETWORK_ERROR:"网络连接不正常,请稍后重试",NETWORK_ERROR_CLICK_RELOGIN:"连接异常, 点击重新登录",COMMON_NOT_YET:"暂未开放",CUR_PLATFORM_NOT_SUPPORT:"此平台不支持",UNLAWFUL_NAME:"请输入6位以内字符",LOGIN_FAILED:"登录失败",GET_USERINFO_FAILD:"获取用户信息失败",ACCOUNT_ERROR:"账号不存在,请注册",REGISTER_SUCCESS:"注册成功",REGISTER_FAILED:"注册失败",BUY_SUCCESS:"购买成功",SIGN_SUCCESS:"签到成功",DAY_INDEX:"第{0}天",NO_REWARD:"暂无奖励",TOKEN_OVERDUE:"验签过期",EMPTY_POSITION:"等待加入",INVITE_SEND_SUCCESS:"邀请已发出",INVITE_INFO:"来自{0}的游戏邀请",INPUT_PLAYER_NAME:"请输入玩家昵称",ANSWERING:"答题中",LOCKED:"尚未解锁",UNLOCKED:"已解锁",NOT_ADD_SELF:"不可以添加自己哦",APPLY_SENDED:"申请已发送",APPLY_SENDED_WAIT_ANS:"申请已发送",WHO_BE_FRIENDS_SUCCEE:"{0}已经成为您的好友",WHO_BE_FRIENDS_FAIL:"{0}拒绝成为您的好友",CHAT_CONTENT_IS_EMPTY:"消息不能为空哦!",CHAT_CONTENT_LIMIT:"消息不能超过{0}个字哦!",COPY_SUCCESS:"复制成功",REDEEMCODE_IS_EMPTY:"请输入兑换码",GET_SUCCESS:"领取成功",NO_GOLD:"金币不足",CAN_NOT_GET_GOLD_BY_WATCH_VIDEO:"还没到领取时间哦!",HAVE_SIGNED_TODAY:"今日已签到",HAVE_GOTTEN_TODAY:"今日已领取",TEMPORARILY_UNAVAILABLE:"暂时不可领取哦",HAVE_WAIT_TOGET:"前面还有未领取的奖励哦",SAVE_TO_PHONE:"已保存至相册",WATCH_ADVIDEO_REWARD_DESC:"观看广告可获得{0}倍奖励，是否观看？",ADVTISEMENT_NUM_GET:"观看广告{0}/{1}次获得",HAVE_GOTTEN:"已经领过了哦！",CUR_LOGIN_DAYS:"当前累计登录：{0} 天",UNLOCK_PET_SKILL:"恭喜解锁技能 {0}"};class g{constructor(){this.mNeedUpdateData=!1,this.mIsFailedUpdate=!1,this._enterChannel="UN-KNOW"}init(e=null){e&&e()}getEnterChannel(){return this._enterChannel}login(e){e&&e()}setLoadingProgress(e){}startGame(e=null){e&&e()}downloadGameData(e=null){e&&e()}updateGameData(e=!1,t=null){Laya.timer.once(1e3,this,()=>{e?this.downloadGameData(()=>{t&&t()}):t&&t()})}getRankList(e){return null}refreshRankData(e,t=null){t&&t()}onShare(e){}appShare(e,t,a,s){o.show(u.CUR_PLATFORM_NOT_SUPPORT)}getSelfData(){return null}fetchRewardedAd(e=null){e&&e()}playAd(e,t){t&&t(0)}fetchBannerAd(e){e&&e(null)}enterPubAccountCard(e){}openWebView(e){}share(e){e&&e(1,0,1)}createShortcut(e){e&&e(!1)}chooseAsync(e=null,t=null){t&&t()}createAsync(e,t=null){t&&t()}setPauseFun(e){}registerListener(e){}unregisterListener(e){}openServiceConversation(e){Laya.Browser.window.location.href="https://qm.qq.com/cgi-bin/qm/qr?k=DYF4aItR37M1UbmwMgLkI0Y7LBoxsL0R#"}getMenuButtonBoundingClientRect(){return null}setClipboardData(e,t){o.show(u.CUR_PLATFORM_NOT_SUPPORT)}getClipboardData(e){o.show(u.CUR_PLATFORM_NOT_SUPPORT)}shareScreenshot(e,t){o.show(u.CUR_PLATFORM_NOT_SUPPORT)}saveImgToPhotoAlbum(e,t){o.show(u.CUR_PLATFORM_NOT_SUPPORT)}setUserCloudStorage(e){}getUserInfo(e){return null}}class S{constructor(){r.SHOW_LOG_TO_SCREEN&&(this.mLogText=new Laya.Label,this.mLogText.text="",this.mLogText.color="#00ff00",this.mLogText.strokeColor="#000000",this.mLogText.stroke=2,this.mLogText.fontSize=24,this.mLogText.width=400,this.mLogText.left=10,this.mLogText.top=0,this.mLogText.align="left",this.mLogText.zOrder=10,this.mLogText.wordWrap=!0,Laya.stage.addChild(this.mLogText),this.mLog=new Array)}static get inst(){return null==S.mInst&&(S.mInst=new S),S.mInst}log(...e){let t="";for(let a=0;a<e.length;a++)t+=e[a]+" ";if(r.SHOW_LOG&&console.log(...e),r.SHOW_LOG&&r.SHOW_LOG_TO_SCREEN){this.mLog.unshift(t),this.mLog.length>S.mLogMax&&this.mLog.pop();let e=this.mLog[0];for(let t=1;t<this.mLog.length;t++)e+="\n"+this.mLog[t];this.mLogText.text=e}}}S.mLogMax=50,function(e){e.DEVTOOLS="devtools",e.IOS="ios",e.ANDROID="android",e.OTHER="other"}(l||(l={}));class m{static goToURL(e){window.location.href=e}static agentContain(e){return-1!=navigator.userAgent.toLowerCase().indexOf(e)}static getSiteURL(){return window.location.href}static getURLParameter(e,t){t||(t=m.getSiteURL()),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}static get(e,t){t||(t=m.getSiteURL()),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}static compareVer(e,t){if(e&&t){for(var a=e.split("."),s=t.split("."),n=Math.min(a.length,s.length),i=0,r=0;i<n&&0==(r=parseInt(a[i])-parseInt(s[i]));)i++;return(r=0!=r?r:a.length-s.length)>0}return!1}static getSystemInfo(){if(m.systemInfo)return m.systemInfo;let e,a;switch(m.systemInfo={},r.PLATFORM_TYPE){case t.DEV:case t.WEB:let n=navigator.userAgent;var s=n.indexOf("Android")>-1||n.indexOf("Adr")>-1;let i=!!n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);m.systemInfo.Type=s?l.ANDROID:i?l.IOS:l.OTHER,m.systemInfo.screenWidth=Laya.Browser.clientWidth,m.systemInfo.screenHeight=Laya.Browser.clientHeight;break;case t.WX:"devtools"==(e=wx.getSystemInfoSync()).platform||("ios"==e.platform?m.systemInfo.Type=l.IOS:"android"==e.platform&&(m.systemInfo.Type=l.ANDROID)),a=e.SDKVersion,m.systemInfo.wxSDKVersion=a,m.systemInfo.screenWidth=e.screenWidth,m.systemInfo.screenHeight=e.screenHeight,m.systemInfo.model=e.model;break;case t.QQ:"devtools"==(e=wx.getSystemInfoSync()).platform?m.systemInfo.Type=l.DEVTOOLS:"ios"==e.platform?m.systemInfo.Type=l.IOS:"android"==e.platform&&(m.systemInfo.Type=l.ANDROID),a=e.SDKVersion,m.systemInfo.wxSDKVersion=a,m.systemInfo.screenWidth=e.screenWidth,m.systemInfo.screenHeight=e.screenHeight,m.systemInfo.model=e.model}return m.systemInfo}static formatSeconds(e,t=1){let a=Math.floor(e),s=0,n=0;a>=60&&(s=Math.floor(a/60),a%=60,s>=60&&(n=Math.floor(s/60),s%=60));let i="";return 3==t?n>0?(i=n+"小时",s>0&&(i+=s+"分钟")):s>0?(i=s+"分钟",a>0&&(i+=a+"秒")):i=a+"秒":2==t?i=n>0?n+"小时"+s+"分"+a+"秒":s>0?s+"分"+a+"秒":a+"秒":(i=a<10?"0"+a:a+"",i=s<10?"0"+s+":"+i:s+":"+i,i=n<10?"0"+n+":"+i:n+":"+i),i}static toBase64(e){let t=new Uint8Array(e),a=t.length,s="";for(let e=0;e<a;e+=3)s+=m.chars[t[e]>>2],s+=m.chars[(3&t[e])<<4|t[e+1]>>4],s+=m.chars[(15&t[e+1])<<2|t[e+2]>>6],s+=m.chars[63&t[e+2]];return a%3==2?s=s.substring(0,s.length-1)+"=":a%3==1&&(s=s.substring(0,s.length-2)+"=="),s}static getRatio(){return m.getSystemInfo().screenWidth/Laya.stage.width}static getRandomArrayElements(e,t){for(var a,s,n=e.slice(0),i=e.length,r=i-t;i-- >r;)a=n[s=Math.floor((i+1)*Math.random())],n[s]=n[i],n[i]=a;return n.slice(r)}static get isWXMiniGame(){return Laya.Browser.onMiniGame}static getStorageData(e,t="string",a=0,s=!0){var n,i=s?m.storageName:"";return n=m.isWXMiniGame?Laya.Browser.window.wx.getStorageSync(i+e):Laya.LocalStorage.getItem(i+e),"number"==t?n?Number(n):a:n}static setStorageData(e,t,a=!0){var s=a?m.storageName:"";m.isWXMiniGame?Laya.Browser.window.wx.setStorageSync(s+e,t+""):Laya.LocalStorage.setItem(s+e,t+"")}static get now(){return Laya.Browser.now()}static isToday(e,t=0){t=t||m.now;var a=new Date(e),s=new Date(t);return a.getFullYear()==s.getFullYear()&&a.getMonth()==s.getMonth()&&a.getDate()==s.getDate()}}m.chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",m.storageName="";class L{constructor(){this.sounds={}}static get instance(){return this._instance||(this._instance=new L),this._instance}playSound(e,t=1,a=0){var s;m.isWXMiniGame?(this.sounds[e]?s=this.sounds[e]:((s=wx.createInnerAudioContext()).src=e,s.loop=0==t,this.sounds[e]=s),s.startTime=a,s.play()):Laya.SoundManager.playSound(e,t)}stopSound(e){m.isWXMiniGame?this.sounds[e]&&this.sounds[e].stop():Laya.SoundManager.stopSound(e)}playMusic(e,t=0){e&&(this._currentBg=e),this._currentBg&&Laya.SoundManager.playMusic(this._currentBg,t)}stopMusic(){this._currentBg=null,Laya.SoundManager.stopMusic()}playCurrentMusic(){this.playMusic(this._currentBg)}}class E{}E.IS_FIRST_PLAY="IS_FIRST_PLAY",E.LEVEL_INDEX="LEVEL_INDEX",E.GEM_NUM="GEM_NUM",E.SCORE="SCORE",E.VIBRATE="VIBRATE",E.SOUND="SOUND",E.MUSIC="MUSIC",E.MAX_SCORE="MAX_SCORE",E.GAME_TODAY="GAME_TODAY",E.LEFT_SCORE="LEFT_SCORE",E.MAX_RELAY_SCORE="MAX_RELAY_SCORE",E.UNLOCK_SKIN="UNLOCK_SKIN_",E.USED_SKIN="USED_SKIN",E.BLACK_COUNT="BLACK_COUNT",E.LOGIN_COUNT="LOGIN_COUNT",E.LAST_LOGIN="LAST_LOGIN",E.INVITE_COUNT="INVITE_COUNT",E.DOUBLE_DATA="DOUBLE_DATA",E.GOLD="GOLD",E.COMBO_WIN="COMBO_WIN",E.REVIVE_COUNT="REVIVE_COUNT";class y{}class C{static sendEvent(e,t){m.isWXMiniGame&&wx.aldSendEvent(String(e),t)}static sendOpenid(e){wx.aldSendOpenid(e)}}class A{}A.GAME_VER=100001,A.CODE_START=100002,A.INIT_FINISH=100003,A.INTERSTITIALAD_LOAD_SUCCESS=200001,A.INTERSTITIALAD_LOAD_ERROR=200002,A.CLOSE_INTER=200003,A.CLOSE_BANNER=200004,A.INTERSTITIALAD_CATCH_ERROR=200005,A.CLOSE_INTER_SUCC=200006,A.CLOSE_BANNER_SUCC=200007,A.SHARE_FOR_NONE=300001,A.SHARE_FOR_REVIVE=300002,A.VIDEO_FOR_NONE=400001,A.VIDEO_FOR_REVIVE=400002,A.GET_MAX_SCORE=600001,A.LEVEL=600002,A.GEM_NUM=600003,A.BTN_REVIVE_NONE=800001,A.BTN_REVIVE_GEM=800002,A.BTN_REVIVE_SHARE=800003,A.BTN_REVIVE_VIDEO=800004,A.REVIVE_FROM_GEM=800005,A.REVIVE_FROM_SHARE=800006,A.REVIVE_FROM_VIDEO=800007,A.BTN_RESTART=800101,A.BTN_RANK_OF_RECOVER_SCENE=800102,A.BTN_NEXTLVL=800201,A.BTN_RANK_OF_LEVL_UP_SCENE=800202;class N{}class R{constructor(){this.noCacheData=new N,this._tmpLayerColor=new Laya.Vector4(0,0,0,1)}static get instance(){return R._instance||(R._instance=new R),R._instance}get userData(){return this._userData||(this._userData=new y),this._userData}set userData(e){this._userData||(this._userData=new y),this._userData=e}init(){this._isFirstPlay=this.getStorageData(E.IS_FIRST_PLAY,"number",1),this._levelIndex=this.getStorageData(E.LEVEL_INDEX,"number",1),this._gemNum=this.getStorageData(E.GEM_NUM,"number",0),this._score=this.getStorageData(E.SCORE,"number",0),this._maxScore=this.getStorageData(E.MAX_SCORE,"number"),this._maxRelayScore=this.getStorageData(E.MAX_RELAY_SCORE,"number"),this._inviteCount=this.getStorageData(E.INVITE_COUNT,"number"),this._gold=this.getStorageData(E.GOLD,"number"),this._comboWinCount=this.getStorageData(E.COMBO_WIN,"number"),this._reviveCount=this.getStorageData(E.REVIVE_COUNT,"number"),this._inviteCount>80&&(this._inviteCount=80);var e=this.getStorageData(E.DOUBLE_DATA,"number");e&&m.isToday(e)&&(this._isTodayDouble=!0),this.uploadScoreAndLevels(this.score,this.levelIndex-1),this._gameCountToday=this.getStorageData(E.GAME_TODAY,"number"),this._gameCountCurrent=0,this._currentScore=this.getStorageData(E.LEFT_SCORE,"number"),this._blackCount=this.getStorageData(E.BLACK_COUNT,"number");var t=this.getStorageData(E.LAST_LOGIN,"number");t?(this._loginCount=this.getStorageData(E.LOGIN_COUNT,"number"),m.isToday(t)||(this._loginCount++,this.setStorageData(E.LAST_LOGIN,m.now),this.setStorageData(E.LOGIN_COUNT,this._loginCount))):(this._loginCount=1,this.setStorageData(E.LAST_LOGIN,m.now),this.setStorageData(E.LOGIN_COUNT,this._loginCount));var a=this.getStorageData(E.VIBRATE);this._vibrate=!a||"1"==a;var s=this.getStorageData(E.SOUND);this._sound=!s||"1"==s;var n=this.getStorageData(E.MUSIC);this._music=!n||"1"==n}set vibrate(e){this._vibrate=e,this.setStorageData(E.VIBRATE,e?1:0)}get vibrate(){return this._vibrate}set sound(e){this._sound=e,this.setStorageData(E.SOUND,e?1:0)}get sound(){return this._sound}set music(e){this._music=e,this.setStorageData(E.MUSIC,e?1:0),this._music||L.instance.stopMusic()}get music(){return this._music}set inviteCount(e){this._inviteCount=e,this.setStorageData(E.INVITE_COUNT,this._inviteCount)}get inviteCount(){return this._inviteCount}set isTodayDouble(e){this._isTodayDouble||(this._isTodayDouble=!0,this.setStorageData(E.DOUBLE_DATA,m.now))}get isTodayDouble(){return this._isTodayDouble}get gold(){return this._gold}addGold(e){this._gold+=e,this._gold<0&&(this._gold=0),this.setStorageData(E.GOLD,this._gold)}get customGold(){return this._customGold}addCustomGold(e){this.addGold(e*this._customGold)}checkMaxScore(){this._tmpAllScore=this.allScore,this._tmpAllScore>this._maxScore&&(this._maxScore=this._tmpAllScore,f.instance.platform.setUserCloudStorage([{key:"friend",value:JSON.stringify({score:this._maxScore})}]),this.setStorageData(E.MAX_SCORE,this._maxScore),C.sendEvent(A.GET_MAX_SCORE,{maxScore:this._maxScore}),this._maxScore),this.setStorageData(E.BLACK_COUNT,this._blackCount)}recordLevelIndex(e){this._levelIndex=e,this.setStorageData(E.LEVEL_INDEX,e),C.sendEvent(A.LEVEL,{levelIndex:e})}get levelIndex(){return this._levelIndex}setIsirstPlay2False(){this._isFirstPlay=0,this.setStorageData(E.IS_FIRST_PLAY,0)}get isFirstPlay(){return 1==this._isFirstPlay}recordGemNum(e){this.setStorageData(E.GEM_NUM,e),this._gemNum=e,C.sendEvent(A.GEM_NUM,{gemNum:e})}get gemNum(){return this._gemNum}recordScore2(e){this.score!=e&&(this._score=e,this.setStorageData(E.SCORE,e),f.instance.platform.setUserCloudStorage([{key:"friend",value:JSON.stringify({score:this._score})}]))}recordScoreAndLevels(e,t){this.score!=e&&(this._score=e,this.setStorageData(E.SCORE,e),this.uploadScoreAndLevels(e,t))}uploadScoreAndLevels(e,t){f.instance.platform.setUserCloudStorage([{key:"friend",value:JSON.stringify({wxgame:{score:e,countClearLvls:t}})}])}get score(){return this._score}get bgIndex(){return this.levelIndex%6}get ballColor(){return this._customBallColor}get ballTexture(){return this._customBallTexture}getCustomLayerColor(e,t){return this._tmpPer=e/(t-1),this._tmpLayerColor.x=this._customLayerColorBegin.x+this._tmpPer*(this._customLayerColorEnd.x-this._customLayerColorBegin.x),this._tmpLayerColor.y=this._customLayerColorBegin.y+this._tmpPer*(this._customLayerColorEnd.y-this._customLayerColorBegin.y),this._tmpLayerColor.z=this._customLayerColorBegin.z+this._tmpPer*(this._customLayerColorEnd.z-this._customLayerColorBegin.z),this._tmpLayerColor}resetScore(e=0){this._currentScore=e}addScore(e,t=1){this._currentScore+=t,e&&this._blackCount++,(!this._lastAddScoreTime||m.now-this._lastAddScoreTime>1900)&&(this._lastAddScoreTime=m.now)}get currentScore(){return this._currentScore}get inviteDaySocre(){return this._isTodayDouble?this._currentScore:0}get inviteHistoryScore(){return this._currentScore*this._inviteCount*.1}get maxScore(){return this._maxScore}get allScore(){return Math.floor(this._currentScore+this.inviteDaySocre+this.inviteHistoryScore)}get doubleMult(){return 100+(this._isTodayDouble?100:0)+10*this._inviteCount}get maxRelayScore(){return this._maxRelayScore}get blackCount(){return this._blackCount}get loginCount(){return this._loginCount}resetGame(){this._levelIndex=1,this.recordLevelIndex(1)}addGameCount(){this._gameCountCurrent++,this._gameCountToday++,this.setStorageData(E.GAME_TODAY,this._gameCountToday)}addReviveCount(){this._reviveCount++,this.setStorageData(E.REVIVE_COUNT,this._reviveCount)}get reviveCount(){return this._reviveCount}get gameCountCurrent(){return this._gameCountCurrent}get gameCountToday(){return this._gameCountToday}get crazyLevel(){return this._crazyLevel}get crazyPro(){return this._crazyPro}get crazyFrame(){return this._crazyFrame}getStorageData(e,t="string",a=0){return m.getStorageData(e,t,a)}setStorageData(e,t){m.setStorageData(e,t)}}class v extends g{constructor(){super(),this._enterChannel="UN-KNOW";let e=wx.getFileSystemManager(),t=`${wx.env.USER_DATA_PATH}/`+"head";try{e.rmdirSync(t,!0)}catch(e){}e.mkdirSync(t,!1),wx.setKeepScreenOn({keepScreenOn:!0,success:e=>{S.inst.log("setKeepScreenOn success")},fail:()=>{S.inst.log("setKeepScreenOn fail")},complete:()=>{S.inst.log("setKeepScreenOn complete")}})}getEnterChannel(){return this._enterChannel}login(e){let t=this;this.wxLoginCB=e,wx.login({success(a){a.code?(S.inst.log("code:"+a.code),t.getSetting(a=>{a["scope.userInfo"]?(t.getWXUserInfo(a=>{t.initWXUserInfo(a,()=>{e&&e()})}),t.isNeedcreateUserInfoButton=!1):(t.isNeedcreateUserInfoButton=!0,e&&e())}),t.handleForwardBack()):(S.inst.log("登录失败！"+a.errMsg),t.handleForwardBack())}})}appShare(e,t,a,s){wx.shareAppMessage({title:e,imageUrl:t,query:a,imageUrlId:s})}onShare(e){this.showShare(!0),wx.aldOnShareAppMessage(e)}showShare(e,t,a,s){wx.showShareMenu({withShareTicket:e,success:t,fail:a,complete:s})}startGame(e=null){e&&e()}downloadGameData(e=null){}updateGameData(e=!1,t=null){}getRankList(){return[]}getSelfData(){return null}fetchVideoAd(e,t){}fetchBannerAd(e){}enterPubAccountCard(e){}openWebView(e){}share(e){}newShare(e){}shareComplete(e,t,a,s){}registerListener(e){}unregisterListener(e){}onLoad(){}onMaximize(){}onMinimize(){}onEnterBackground(e){wx.onHide(e)}onEnterForward(e){S.inst.log(" call wx.onShow"),wx.onShow(e)}onClose(){}getUserInfo(e){this.getSetting(t=>{t["scope.userInfo"]?this.getWXUserInfo(t=>{e(t)}):this.createUserInfoButton(e)})}createUserInfoButton(e){S.inst.log("start createUserInfoButton");let t=wx.getSystemInfoSync(),a=t.screenWidth/Laya.stage.width,s=525*a,n=141*a,i=290*a,r=(t.screenWidth-s)/2,o=(t.screenHeight-n)/2+i,l=wx.createUserInfoButton({type:"image",image:"btn_annd_trans.png",style:{left:r,top:o,width:s,height:n},withCredentials:!1});l.show(),l.onTap(t=>{if(S.inst.log("getWXUserInfo-userInfoBtn -res:",t),"getUserInfo:ok"==t.errMsg){S.inst.log("授权成功");let a=t.userInfo;e(a),l.destroy()}else S.inst.log("授权失败"),e(null),l.destroy()})}getSetting(e){wx.getSetting({success(t){S.inst.log("res.authSetting-success",t.authSetting),e(t.authSetting)},fail(e){S.inst.log("res.authSetting-fail",e.authSetting)},complete(e){S.inst.log("res.authSetting-complete",e.authSetting)}})}getWXUserInfo(e){wx.getUserInfo({success:t=>{let a=t.userInfo;S.inst.log("getWXUserInfo -res:",t),e(a)}})}initWXUserInfo(e,t){R.instance.userData.nickName=e.nickName,R.instance.userData.avatarUrl=e.avatarUrl,t&&t()}openServiceConversation(e){wx.openCustomerServiceConversation({sessionFrom:"",showMessageCard:!0,sendMessageTitle:"Hello",sendMessageImg:"xuebaGroup1.png",success:e=>{S.inst.log("openCustomerServiceConversation success")},fail:e=>{S.inst.log("openCustomerServiceConversation fail")},complete:e=>{S.inst.log("openCustomerServiceConversation complete")}})}handleForwardBack(){this.onEnterBackground(()=>{L.instance.stopMusic()}),this.onEnterForward(e=>{L.instance.playCurrentMusic()})}saveLaunchInfo(){let e=wx.getLaunchOptionsSync(),t=e.query;if(S.inst.log("launchOptions--"+JSON.stringify(e)),"string"==typeof t){let e=t.split("?");e[0],e[1]}}getMenuButtonBoundingClientRect(){let e=wx.getMenuButtonBoundingClientRect(),t=wx.getSystemInfoSync(),a=Laya.stage.width/t.screenWidth;return e.width*=a,e.height*=a,e.top*=a,e.right*=a,e.bottom*=a,e.left*=a,e}setClipboardData(e,t){wx.setClipboardData({data:e,success(e){t()}})}getClipboardData(e){wx.getClipboardData({success(t){e(t.data)}})}shareScreenshot(e,t,a=!0){let s=e.width,n=e.height;e.drawToCanvas(s,n,0,0).getCanvas().toTempFilePath({x:0,y:0,width:s,height:n,destWidth:s,destHeight:n,success:function(s){a&&e.destroy(!0),wx.shareAppMessage({imageUrl:s.tempFilePath,title:t})}})}saveImgToPhotoAlbum(e,t){let a=e.width,s=e.height;e.drawToCanvas(a,s,0,0).getCanvas().toTempFilePath({x:0,y:0,width:a,height:s,destWidth:a,destHeight:s,success:function(e){wx.saveImageToPhotosAlbum({filePath:e.tempFilePath,complete:t})}})}vibrateShort(e,t){m.isWXMiniGame&&wx.vibrateShort({success:function(a){e&&t&&t.call(e,{code:0})},fail:function(){e&&t&&t.call(e,{code:1})},complete:function(){e&&t&&t.call(e,{code:2})}})}vibrateLong(e,t){m.isWXMiniGame&&(S.inst.log("wx.vibrateLong send"),wx.vibrateLong({success:function(a){S.inst.log("wx.vibrateLong success"),e&&t&&t.call(e,{code:0})},fail:function(){S.inst.log("wx.vibrateLong fail"),e&&t&&t.call(e,{code:1})},complete:function(){S.inst.log("wx.vibrateLong complete"),e&&t&&t.call(e,{code:2})}}))}setUserCloudStorage(e){wx.setUserCloudStorage&&wx.setUserCloudStorage({KVDataList:e,success:e=>{console.log("setUserCloudStorage- success res: ",e)},fail:e=>{console.log("setUserCloudStorage- fall res: ",e)},complete:e=>{console.log("setUserCloudStorage- complete res: ",e)}})}}class p{constructor(){this.mClasses={},this.mClasses.dev=g,this.mClasses.web=g,this.mClasses.wx=v,this.mClasses.qq=v}static get inst(){return null==p.mInst&&(p.mInst=new p),p.mInst}getPlatform(e){let t=this.mClasses[e];return null==t&&(console.log("当前平台不存在！！！将切换至Dummy环境！！！"),t=this.mClasses.Dummy),new t}}class T{static createRewardedVideoAd(e,t){m.isWXMiniGame&&(console.log("wx.createRewardedVideoAd send"),T.rewardedVideoAd||Laya.Browser.window.wx.createRewardedVideoAd&&(console.log("激励视频 创建:"+e),T.rewardedVideoAd=Laya.Browser.window.wx.createRewardedVideoAd({adUnitId:e}),T.rewardedVideoAd.onError(e=>{console.log("rewardedVideoAd.onError, ",e)}),T.rewardedVideoAd.onLoad(()=>{console.log("激励视频 广告加载成功"),t&&t()})))}static showRewardedVideoAd(e,t){if(m.isWXMiniGame)if(T.rewardedVideoAd){console.log("激励视频 show"),T.rewardedVideoAd.show().catch(a=>{w.isNoAds=!0,console.log(a),e&&t&&t.call(e,{code:0})});var a=function(s){s&&s.isEnded||void 0===s?e&&t&&t.call(e,{code:0}):e&&t&&t.call(e,{code:1}),T.rewardedVideoAd.offClose(a)};T.rewardedVideoAd.onClose(a)}else console.log("激励视频 未创建"),e&&t&&t.call(e,{code:0})}}class O{static init(e){for(console.warn("banner init:"),O._ids=[];e.length;){var t=Math.floor(Math.random()*e.length);O._ids.push(e[t]),e.splice(t,1)}O._banners=[],O.isNoBanners=!0,O._isFirstLoad=!0,O._ids.length&&O.createBannerAd(O._ids[0]),Laya.timer.loop(2e4,this,O.checkIsLoaded)}static checkIsLoaded(){O._isFirstLoad&&(O._isFirstLoad=!1,C.sendEvent(O.BANNER_FIRSTLOAD+O._banners.length)),O.isNoBanners&&(O._isReloaded=!0,C.sendEvent(O.BANNER_NONE)),O._banners.length<O._atLeastLength?O.start(0):Laya.timer.clear(this,O.checkIsLoaded)}static initParam(e,t){O._atLeastLength=e,O._showTimes=t}static start(e){var t=-1;for(let a=e;a<O._ids.length;a++)O.isPushed(O._ids[a])||(t++,Laya.timer.once(1e3*t,this,()=>{O.createBannerAd(O._ids[a])},null,!1))}static isPushed(e){for(var t=0;t<O._banners.length;t++)if(O._banners[t].id==e)return!0;return!1}static getBannerData(){if(O._banners.length){for(var e=0;e<O._banners.length;e++){if((s=O._banners[e]).isShow)return s}var t=99,a=0;for(e=0;e<O._banners.length;e++){var s;if(!(s=O._banners[e]).isTouched){if(0==s.showTimes)return s;s.showTimes<t&&(t=s.showTimes,a=e)}}return O._banners[a]}return null}static createBannerAd(e){if(Laya.Browser.onMiniGame)if(Laya.Browser.window.wx.createBannerAd){console.warn("banner 创建:"+e);var t=Laya.Browser.window.wx.createBannerAd({adUnitId:e,style:{left:0,top:0,width:9999}});t.onError(e=>{O._hasBannerLoadError=!0,C.sendEvent(O.BANNER_LOAD_FAIL),Laya.timer.once(6e4,this,O.resetBannerLoadError)}),t.onLoad(()=>{C.sendEvent(O.BANNER_LOAD_SUCCESS)}),t.onResize(()=>{if(t.style&&(t.style.realWidth?(t.style.left=m.getSystemInfo().screenWidth-t.style.realWidth>>1,t.style.top=m.getSystemInfo().screenHeight-t.style.realHeight):(t.style.left=m.getSystemInfo().screenWidth-300>>1,t.style.top=m.getSystemInfo().screenHeight-100)),!O.isPushed(e)){O.isNoBanners&&(console.warn("第一个广告加载成功"),O._isReloaded?C.sendEvent(O.BANNER_RELOAD_SUCCESS):C.sendEvent(O.BANNER_LOAD_ONE)),O.isNoBanners=!1;var a=new I;a.id=e,a.banner=t,O._banners.push(a)}})}else{var a;if(!O._isNoAdsSend)O._isNoAdsSend=!0,m.getSystemInfo()&&m.getSystemInfo().model&&(a=m.getSystemInfo().model),C.sendEvent(O.BANNER_NO_API,{model:a})}}static resetBannerLoadError(){O._hasBannerLoadError=!1}static showBannerAd(e=0){if(Laya.Browser.onMiniGame){if(O._banners&&O._banners.length){var t=O.getBannerData();if(t)return t.banner.style&&(t.banner.style.realWidth&&m.getSystemInfo().screenWidth?(t.banner.style.left=m.getSystemInfo().screenWidth-t.banner.style.realWidth>>1,t.banner.style.top=m.getSystemInfo().screenHeight-t.banner.style.realHeight+e):(t.banner.style.left=m.getSystemInfo().screenWidth-300>>1,t.banner.style.top=m.getSystemInfo().screenHeight-100+e)),t.showTimes++,t.banner.show(),t.isShow=!0,C.sendEvent(O.BANNER_SHOW_SUCCESS),t.isTouched&&O._banners.length<=O._atLeastLength&&(O.isAllTouched=!0,console.log("isAllTouched","warn")),t.banner;C.sendEvent(O.BANNER_SHOW_FAIL)}return null}}static hideBannerAd(e,t=!1){if(Laya.Browser.onMiniGame&&O._banners&&O._banners.length){for(var a=0;a<O._banners.length;a++){var s=O._banners[a];s.isShow&&(s.isShow=!1,s.isTouched=e,s.banner.hide())}t&&O.checkDestroy()}}static checkDestroy(){if(O._banners.length>=O._atLeastLength&&!O._hasBannerLoadError)for(var e=0;e<O._banners.length;e++){var t=O._banners[e];if(!t.isShow&&t.isTouched||t.showTimes>=O._showTimes)return t.banner.destroy(),O._banners.splice(e,1),void O.createBannerAd(t.id)}}}O.BANNER_LOAD_SUCCESS=72e4,O.BANNER_LOAD_FAIL=720001,O.BANNER_SHOW_SUCCESS=720002,O.BANNER_SHOW_FAIL=720003,O.BANNER_NONE=720004,O.BANNER_NO_API=720005,O.BANNER_RELOAD_SUCCESS=720006,O.BANNER_LOAD_ONE=720007,O.BANNER_FIRSTLOAD=73e4,O._banners=[],O._atLeastLength=3,O._showTimes=1,O.isNoBanners=!0,O.isAllTouched=!1;class I{constructor(){this.showTimes=0}}class D{static createInterstitialAd(e){if(Laya.Browser.onMiniGame&&Laya.Browser.window.wx.createInterstitialAd)try{console.log("插屏广告 创建:"+e),D.interstitialAd=Laya.Browser.window.wx.createInterstitialAd({adUnitId:e}),D.interstitialAd.onLoad(function(){console.log("插屏广告加载成功"),C.sendEvent(A.INTERSTITIALAD_LOAD_SUCCESS),D.interstitialAd&&D.interstitialAd.show&&D.interstitialAd.show().catch(e=>{console.error(e)})}),D.interstitialAd.onError(function(){console.log("插屏广告加载失败"),C.sendEvent(A.INTERSTITIALAD_LOAD_ERROR)}),D.interstitialAd.onClose(function(){D.interstitialAd&&D.interstitialAd.destroy&&D.interstitialAd.destroy()})}catch(e){C.sendEvent(A.INTERSTITIALAD_CATCH_ERROR)}}}D.interstitialAd=null,D._bLoadInterstitialAdSuccess=!1;class w{static get gameVersion(){return w._gameVersion}static init(){this.initConfig(),this.getCfg(),this.getCpaCfg()}static initConfig(){this._gameVersion=n.VERSION,this._urlCfg=n.URL_ENCOURAGE_CFG,this._urlCpa=n.URL_CPA,this._urlMoreGame=n.URL_MORE_GAME,this._urlFloatGame=n.URL_FLOAT_GAME,this._rewardedVideoAdId=n.REWARDED_VIDEOAD_ID,this._bannerIds=n.BANNER_IDS,w._dispatcher=new Laya.EventDispatcher;var e=m.now,t=m.getStorageData(w.STORAGE_SIGN_DATE);t?m.isToday(Number(t))?w._isNewPlayer=!0:w._isNewPlayer=!1:(t=e+"",m.setStorageData(w.STORAGE_SIGN_DATE,t),w._isNewPlayer=!0);var a=m.getStorageData(w.STORAGE_ADS_DATE);a?m.isToday(Number(a))?m.getStorageData(w.STORAGE_ADS_COUNT)||m.setStorageData(w.STORAGE_ADS_COUNT,"0"):(m.setStorageData(w.STORAGE_ADS_DATE,e+""),m.setStorageData(w.STORAGE_ADS_COUNT,"0")):(m.setStorageData(w.STORAGE_ADS_DATE,e+""),m.setStorageData(w.STORAGE_ADS_COUNT,"0"));var s=m.getStorageData(w.STORAGE_SHARE_DATE);s?m.isToday(Number(s))?m.getStorageData(w.STORAGE_SHARE_COUNT)||m.setStorageData(w.STORAGE_SHARE_COUNT,"0"):(m.setStorageData(w.STORAGE_SHARE_DATE,e+""),m.setStorageData(w.STORAGE_SHARE_COUNT,"0")):(m.setStorageData(w.STORAGE_SHARE_DATE,e+""),m.setStorageData(w.STORAGE_SHARE_COUNT,"0"));w._isOpenShare=!0,w._shareNum=2,w._adsNum=-1}static getCfg(){}static getCpaCfg(){w._urlCpa&&Laya.loader.create(this._urlCpa+"?time="+(new Date).getTime(),Laya.Handler.create(this,e=>{if(e)try{if(e.cpaChannel){w.cpaChannel=[];for(var t=e.cpaChannel.split(","),a=0;a<t.length;a++)w.cpaChannel.push(Number(t[a]))}if(e.cpaGameNum){w.cpaGameNum=[];for(t=e.cpaGameNum.split(","),a=0;a<t.length;a++)w.cpaGameNum.push(Number(t[a]))}if(e.cpaDayMaxJumpNum){w.cpaDayMaxJumpNum=[];for(t=e.cpaDayMaxJumpNum.split(","),a=0;a<t.length;a++)w.cpaDayMaxJumpNum.push(Number(t[a]))}if(e.mpGameNum){w.mpGameNum=[];for(t=e.mpGameNum.split(","),a=0;a<t.length;a++)w.mpGameNum.push(Number(t[a]))}if(e.mpDayMaxJumpNum){w.mpDayMaxJumpNum=[];for(t=e.mpDayMaxJumpNum.split(","),a=0;a<t.length;a++)w.mpDayMaxJumpNum.push(Number(t[a]))}var s=m.now,i=m.getStorageData(w.STORAGE_SIGN_DATE);if(i){var r=s-Number(i);w.currentDay=Math.ceil(r/864e5)}else i=s+"",w.currentDay=1;var o=m.getStorageData(w.STORAGE_REGISTER_DATE);if(o?w.currentDay>o&&(m.setStorageData(w.STORAGE_REGISTER_DATE,w.currentDay),m.setStorageData(w.STORAGE_JUMP_COUNT,0)):(m.setStorageData(w.STORAGE_REGISTER_DATE,w.currentDay),m.setStorageData(w.STORAGE_JUMP_COUNT,0)),f.instance.platform.getEnterChannel()){var l=!1;for(a=0;a<w.cpaChannel.length;a++)if(Number(f.instance.platform.getEnterChannel())==w.cpaChannel[a]){w.cpaType=0,l=!0;break}l||(w.cpaType=1)}}catch(e){console.log("Encourage cpa error")}console.log("PLAT_SWITCH - syncData:",n.PLAT_SWITCH)}))}static get type(){return w.isExaminedVersion?w.TYPE_ADS:w._isOpenShare?-1==w._shareNum?w.isNoAds?w.TYPE_SHARE:w.todayAds<w._adsNum?w.TYPE_ADS:w.TYPE_SHARE:w.todayShares<w._shareNum?w.TYPE_SHARE:w.isNoAds?w.TYPE_SHARE:w.TYPE_ADS:w.isNoAds?w.TYPE_NONE:-1==w._adsNum?w.TYPE_ADS:w.todayAds<w._adsNum?w.TYPE_ADS:w.TYPE_NONE}static play(e,t,a,s=!0){var n=w.type;n==w.TYPE_ADS?w.ads(e,t,a):n==w.TYPE_SHARE?w.share(e,null,t,a,s):t&&a&&a.call(t,{code:1})}static share(e,t,a,s,n=!1,i=!1,r=0){var l;C.sendEvent(e);var c=i?0:w.randomShareResult();if(m.isWXMiniGame){let a=t;a.ald_desc=""+e,console.log("aldShareInfo:",a),wx.aldShareAppMessage(a),0==c&&(n?w.startShareTime=m.now:l=!0)}Laya.timer.once(1e3,this,()=>{if(l);else{var h=m.now;c=h-w.startShareTime<2e3?1:0}o.show(w.SHARE_RESULT[c]),w.doShareCallBack(t,c,e,a,s,n,i,r)}),w.addTodayShares()}static doShareCallBack(e,t=0,a,s,n,i=!1,r=!1,o=0){s&&n&&(0==t?n.call(s,{code:t}):w._needShowSecondAlert&&0==o?w.showModel("分享失败，无法获取奖励，重新分享！",this,o=>{0==o.code?w.share(a,e,s,n,i,r,1):n.call(s,{code:t})}):n.call(s,{code:t}))}static addTodayShares(){var e=m.getStorageData(w.STORAGE_SHARE_COUNT);e||(e="0"),e=Number(e)+1+"",m.setStorageData(w.STORAGE_SHARE_COUNT,e)}static get todayAds(){var e=m.getStorageData(w.STORAGE_ADS_COUNT);return e||(e="0"),Number(e)}static showModel(e,t,a){wx.showModal?wx.showModal({title:"提示",content:e,success(e){e.confirm?a.call(t,{code:0}):e.cancel&&a.call(t,{code:1})},fail(){a.call(t,{code:1})}}):a.call(t,{code:1})}static randomShareResult(){var e=w.todayShares,t=0,a=100*Math.random();return 0==e?a<w._firstShareRandom&&(t=1+Math.floor(a)%2):e>3&&a<w._moreShareRandom&&(t=2+Math.floor(a)%2),t}static get todayShares(){var e=m.getStorageData(w.STORAGE_SHARE_COUNT);return e||(e="0"),Number(e)}static setScale(){var e=375;m.isWXMiniGame&&(e=m.getSystemInfo()&&m.getSystemInfo().screenWidth?m.getSystemInfo().screenWidth:375),w._screenWidth=e,w._scale=Laya.stage.width/e,console.log("fullWidth:"+e),console.log("Encourage.scale:"+w._scale)}static get dispatcher(){return w._dispatcher}static reDisplay(e,t,a=null){if(e){var s,n=w.getAdsHeight(t),i=Laya.stage.height-n;if(s=Math.min(i/e.height,1),e.scale(s,s),e.y=i-e.height*s,e.x=.5*(Laya.stage.width-e.width*s),a){for(var r=0;r<a.length;r++)a[r].visible=!1;Laya.timer.once(1200,this,()=>{for(var e=0;e<a.length;e++)a[e].visible=!0})}}}static get adsOffsetY(){return m.isWXMiniGame&&m.getSystemInfo()&&-1!=m.getSystemInfo().model.indexOf("iPhone X")?34:0}static getOffsetY(e,t){var a=e.y,s=0;if(m.isWXMiniGame){var n=O.showBannerAd();s=n&&n.style?t?300==n.style.width?w._screenWidth*n.style.realHeight/300:n.style.realHeight:300==n.style.width?n.style.realHeight:300*n.style.realHeight/w._screenWidth:100,s+=w.adsOffsetY,s*=w._scale}s||(s=w.BANNER_NORMAL_Y);var i,r=Laya.stage.height-s;return i=Math.min(r/e.height,1),e.scale(i,i),a-(r-e.height*i)}static getAdsHeight(e){var t=0;if(m.isWXMiniGame){var a=O.showBannerAd();t=a&&a.style?e?300==a.style.width?w._screenWidth*a.style.realHeight/300:a.style.realHeight:300==a.style.width?a.style.realHeight:300*a.style.realHeight/w._screenWidth:100,t+=w.adsOffsetY,t*=w._scale}else t=150;return t||(t=w.BANNER_NORMAL_Y),t}static showBanner(){m.isWXMiniGame&&O.showBannerAd()}static hideBanner(e){m.isWXMiniGame&&O.hideBannerAd(!1,e)}static get isExaminedVersion(){return!(w._version&&!m.compareVer(w._gameVersion,w._version))}static addTodayAds(){var e=m.getStorageData(w.STORAGE_ADS_COUNT);e||(e="0"),e=Number(e)+1+"",m.setStorageData(w.STORAGE_ADS_COUNT,e)}static ads(e,t,a,s=!0,n=0){e<99999&&(e+=8e5),C.sendEvent(e),w.isNoAds?s&&w._isOpenShare&&!w.isExaminedVersion?w.share(e,null,t,a,!0):(o.show("无法获取视频"),t&&a&&a.call(t,{code:-1})):m.isWXMiniGame?T.showRewardedVideoAd(this,i=>{if(i.code>0&&(i.code=0-i.code),0==i.code)w.addTodayAds();else if(w._needShowSecondAlert&&0==n)return void w.showModel("视频没有看完，无法获取奖励，再看一次！",this,n=>{0==n.code?w.ads(e,t,a,s,1):a.call(t,{code:i.code})});t&&a&&a.call(t,{code:i.code})}):Laya.timer.once(500,this,()=>{t&&a&&a.call(t,{code:0})})}static showInterstitialAd(){this._interstitialId&&D.createInterstitialAd(this._interstitialId)}}w.STORAGE_SIGN_DATE="encourage_sign_date",w.STORAGE_ADS_DATE="encourage_ads_date",w.STORAGE_ADS_COUNT="encourage_ads_count",w.STORAGE_SHARE_DATE="encourage_share_date",w.STORAGE_SHARE_COUNT="encourage_share_count",w.STORAGE_REGISTER_DATE="encourage_register_date",w.STORAGE_JUMP_COUNT="encourage_jump_count",w._isNewPlayer=!1,w._firstShareRandom=60,w._moreShareRandom=30,w._needShowSecondAlert=!0,w.reviveType=0,w.cpaOpen=0,w.openMoreGameDNum=5,w.openMoreGameLNum=1,w.loginBanner=100,w.jbBanner=0,w.newOpenWatchNum=0,w.adsDelayTime=800,w.bannerTimes=[800,1400,1400,1400],w.bannerShowTimes=1,w.atLeastBanners=2,w._bannerIds=[],w._rewardedVideoAdId="",w._interstitialId="",w.cpaType=1,w.currentDay=1,w.TYPE_NONE=0,w.TYPE_SHARE=1,w.TYPE_ADS=2,w.startShareTime=0,w.SHARE_RESULT=["分享成功啦","分享失败了","请分享到群","要分享到不同的群哦"],w.BANNER_NORMAL_Y=250.123;class f extends Laya.EventDispatcher{constructor(){super(...arguments),this.isSendedResToOpenData=!1}static get instance(){return f._instance||(f._instance=new f),f._instance}get platform(){return this.mPlatform}init(){r.PLATFORM_TYPE=t.DEV,m.isWXMiniGame&&(r.PLATFORM_TYPE=t.WX),this.mPlatform=p.inst.getPlatform(r.PLATFORM_TYPE),this.mPlatform.init(()=>{window.Encourage=w,window.Toast=o,w.init(),f.instance.platform.onShare(()=>({title:"球球向上",imageUrl:""})),this.startLoadRes()})}onResLoad(){this.expandLaya(),Laya.Scene.root.zOrder=1,q.startScene&&Laya.Scene.open(q.startScene)}startLoadRes(){var e=[{url:n.URL_BG0,type:Laya.Loader.IMAGE},{url:n.URL_COMP,type:Laya.Loader.ATLAS}];let t=[].concat(e);Laya.loader.create(t,Laya.Handler.create(this,this.onResLoad))}onlyShare(){f.instance.platform.appShare(r.ShareInfo.title,r.ShareInfo.imageUrl)}expandLaya(){Laya.Label.prototype.num=function(e,t,a,s=0,n,i){let r=(e-s)/t,o=s,l=new Laya.Timer,c=l.currTimer;l.loop(50,this,()=>{o+=50*r;let s=n||"",h=a||"";this.text=s+String(Math.round(o))+h,l.currTimer-c>=t&&(l.clearAll(this),this.text=s+String(e)+h,i&&i())})}}}class U extends e.FriendRankSceneUI{constructor(){super(),this.init()}onEnable(){Laya.Tween.from(this,{alpha:.2},300,null,Laya.Handler.create(this,()=>{})),Laya.Browser.onMiniGame&&(f.instance.isSendedResToOpenData?wx.postMessage({cmd:"REFRESH_RANK"}):(Laya.MiniAdpter.sendAtlasToOpenDataContext("res/atlas/comp.atlas"),f.instance.isSendedResToOpenData=!0))}onOpened(e){console.log("FriendRankScene onOpened"),this._preScene=e,this.openDataCanvas.visible=!0,n.PLAT_SWITCH.SHOW_BANNER_AD_FRIEND_RANKSCENE&&w.showBanner()}onClosed(){console.log("FriendRankScene onClosed"),w.hideBanner(!0),this.openDataCanvas.visible=!1}init(){this.btnBack.on(Laya.Event.CLICK,this,this.onBtnBack)}onBtnBack(){console.log("onBtnBack"),Laya.Scene.close(U.SCENE),Laya.Scene.open(this._preScene.SCENE,!1)}}U.LOCAL="view/FriendRankScene.ts",U.SCENE="FriendRankScene.scene";class M extends Laya.EventDispatcher{on(e,t,a,s){return super.on(String(e),t,a,s)}once(e,t,a,s){return super.once(String(e),t,a,s)}off(e,t,a,s){return super.off(String(e),t,a,s)}event(e,t){return super.event(String(e),t)}static get instance(){return M.mInstance||(M.mInstance=new M),M.mInstance}}class b extends Laya.EventDispatcher{}b.GAME_STATE="GAME_STATE",b.UPDATE_LEVEL="UPDATE_LEVEL",b.UPDATE_CHILD_LEVEL="UPDATE_CHILD_LEVEL",b.CYLINDER_COMPLETE="CYLINDER_COMPLETE",b.ON_CREATE_PLAYER="ON_CREATE_PLAYER",b.UPDATE_GEM_NUM="UPDATE_GEM_NUM",b.UPDATE_SCORE="UPDATE_SCORE",b.ON_BALL_SHOOT="ON_BALL_SHOOT",b.ON_RECOVER="ON_RECOVER";class B extends Laya.Script3D{constructor(){super(...arguments),this.speedRange=[.001,.0025]}onAwake(){console.log("EnemyGroupCtrl onStart");let e=this.owner;this._gameObject=e,this._tween=new Laya.Tween,this.resetSpeed()}onUpdate(){W.instance.gameState==_.Playing&&this._gameObject.transform.rotate(new Laya.Vector3(0,this._speed*Laya.timer.delta,0),!0)}reset(){this.resetSpeed()}resetSpeed(){this._tween.clear(),this._speed=this.speedRange[1],z.instance.curChildLevel>1&&this.dealSpeed()}dealSpeed(e=null){null==e&&(e=300*Math.random()),this._tween.to(this,{_speed:0},3e3,null,Laya.Handler.create(this,()=>{let e=this.speedRange[1];Math.random()>=.5&&(e*=-1),this._tween.to(this,{_speed:e},3e3,null,Laya.Handler.create(this,()=>{this.dealSpeed()}))}),e)}}class G{static copy(e){return new Laya.Vector3(e.x,e.y,e.z)}static add(e,t){return new Laya.Vector3(e.x+t.x,e.y+t.y,e.z+t.z)}static addMore(...e){e instanceof Array||(e=[]);let t=new Laya.Vector3;for(let a of e)t.x+=a.x,t.y+=a.y,t.z+=a.z;return t}static sub(e,t){return new Laya.Vector3(e.x-t.x,e.y-t.y,e.z-t.z)}static mulNum(e,t){return new Laya.Vector3(e.x*t,e.y*t,e.z*t)}static negative(e){return new Laya.Vector3(-e.x,-e.y,-e.z)}static normalize(e){let t=new Laya.Vector3;return Laya.Vector3.normalize(e,t),t}static sqrt(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}static catmullRom(e,t,a,s,n){let i=t,r=G.mulNum(G.sub(a,e),.5),o=G.mulNum(G.sub(a,t),3),l=G.mulNum(G.sub(s,t),.5),c=G.mulNum(G.sub(a,e),1),h=G.sub(G.sub(o,l),c),d=G.mulNum(G.sub(a,t),-2),_=G.mulNum(G.sub(s,t),.5),u=G.mulNum(G.sub(a,e),.5),g=G.addMore(d,_,u),S=G.mulNum(g,n*n*n),m=G.mulNum(h,n*n),L=G.mulNum(r,n),E=i;return G.addMore(S,m,L,E)}}G.back=new Laya.Vector3(0,0,-1),G.down=new Laya.Vector3(0,-1,0),G.forward=new Laya.Vector3(0,0,1),G.left=new Laya.Vector3(-1,0,0),G.one=new Laya.Vector3(1,1,1),G.right=new Laya.Vector3(1,0,0),G.up=new Laya.Vector3(0,1,0),G.zero=new Laya.Vector3(0,0,0);class x{static get instance(){return this._instance||(this._instance=new x),this._instance}soundFormat(e){return(e="res/audio/"+e)+".mp3"}playBgm(){R.instance.music&&L.instance.playMusic(this.soundFormat("bgm"))}playHit(){this.play("se_balhit")}playHitDie(){this.play("se_ballhitdie")}playLevelUp(){this.play("se_levelup")}playCircleLayerFinish(){this.play("se_stagefinish")}play(e,t=!1,a=1){if(R.instance.sound){if(t&&this._lastUrl==e){var s=m.now;this._lastTime?s-this._lastTime>100&&(L.instance.playSound(this.soundFormat(e),a),this._lastTime=s):(this._lastTime=s,L.instance.playSound(this.soundFormat(e),a))}else L.instance.playSound(this.soundFormat(e),a);this._lastUrl=e}}vibrate(){R.instance.vibrate&&m.isWXMiniGame&&f.instance.platform.vibrateShort()}}class P extends Laya.Script3D{constructor(){super(...arguments),this.tempT=0}onEnable(){console.log("PlayerCtrl onStart");let e=this.owner;this._gameObject=e,this._sphere=e,this._rig=this._sphere.getComponent(Laya.Rigidbody3D),this._target=W.instance.playerTargetPoint,this._startPos=G.copy(this._gameObject.transform.position),this._dir=G.normalize(G.sub(this._target.transform.position,this._sphere.transform.position)),window.player=this._gameObject,window.rig=this._rig,this.addListener(),this.showStepInAni(),W.instance.temoCount++}showStepInAni(){P.tCount++,this._canShoot=!1;let e=this._gameObject.getChildByName("Trail");e.active=!1;let t=this._gameObject.transform.localPositionY;console.log("t1111--"+P.tCount+"this._gameObject.transform.position - pre:",this._gameObject.transform.position),Laya.Tween.from(this._gameObject.transform,{localPositionY:t-3},30,null,Laya.Handler.create(this,()=>{console.log("t1111--"+P.tCount+"t1111--this._gameObject.transform.position - aft:",this._gameObject.transform.position),this._gameObject.transform.position=this._startPos,this._canShoot=!0,e.active=!0}))}onUpdate(){}onDestroy(){console.log("PlayerCtrl onDestroy: temoCount = ",W.instance.temoCount),this.removeListener()}onTriggerEnter(e){if(this._isTriggerEntered)return;if(this._isTriggerEntered=!0,console.log("onTriggerEnter"),console.log("onTriggerEnter other ",e),W.instance.gameState!=_.Playing)return;if(W.instance.shakeEnemyGroup(),"AfterPaint"===e.owner.name)return console.log("碰到已染色扇形：死亡"),x.instance.playHitDie(),W.instance.setSectionStatus(e.owner.parent,d.Dead),void this.dealDead();if("BeforePaint"===e.owner.name){console.log("碰到环形圆柱：染色"),x.instance.playHit();let t=e.owner.parent;W.instance.setSectionStatus(t,d.Paint),this.owner.destroy();let a=t.getChildByName("Gem");if(a.active){let e=R.instance.gemNum,t=e+1;R.instance.recordGemNum(t),M.instance.event(b.UPDATE_GEM_NUM,[!0,e]),a.destroy()}}}onTriggerStay(){}shootBall(){if(W.instance.gameState!=_.Playing)return;if(!this._canShoot)return;this._canShoot=!1,this.removeListener();this._rig.linearVelocity=G.mulNum(this._dir,30),console.log("shootBall --this._rig.linearVelocity",this._rig.linearVelocity),M.instance.event(b.ON_BALL_SHOOT)}dealDead(){W.instance.gameState=_.Fail,this.removeListener(),this._rig.linearVelocity=new Laya.Vector3(12,1,0),this._rig.overrideGravity=!0,this._rig.gravity=new Laya.Vector3(0,-25,0),Laya.timer.once(5e3,this,()=>{this._gameObject.destroy()})}addListener(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onMouseEvent),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onMouseEvent),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMouseEvent),Laya.stage.on(Laya.Event.MOUSE_OUT,this,this.onMouseEvent)}removeListener(){Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.onMouseEvent),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onMouseEvent),Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.onMouseEvent),Laya.stage.off(Laya.Event.MOUSE_OUT,this,this.onMouseEvent)}onMouseEvent(e){switch(e.type){case Laya.Event.MOUSE_DOWN:this.touchTempX=e.stageX,this.touchTempY=e.stageY,this.shootBall();break;case Laya.Event.MOUSE_MOVE:e.stageX,this.touchTempX,e.stageY,this.touchTempY;break;case Laya.Event.MOUSE_UP:}}}P.tCount=0;class V extends e.RecoverSceneUI{constructor(){super(),this.init()}onEnable(){console.log("RecoverScene onEnable"),Laya.Tween.from(this,{alpha:.2},300,null,Laya.Handler.create(this,()=>{})),this.dealBtnRecoverStatus()}onOpened(){n.PLAT_SWITCH.SHOW_BANNER_AD_RECOVERSCENE&&w.showBanner()}onClosed(){w.hideBanner(!0)}dealBtnRecoverStatus(){if(n.RECOVER_REQ_GEM_NUM<=R.instance.gemNum)this._recoverType=c.GEM;else if(m.isWXMiniGame){let e=Math.random()>=.5;this._recoverType=e?c.SHARE:c.VIDEO,n.PLAT_SWITCH.USE_VIDEO_TO_REVIVE||(this._recoverType=c.SHARE)}else this._recoverType=c.NONE;this.imgGem.visible=this._recoverType==c.GEM,this.imgShare.visible=this._recoverType==c.SHARE,this.imgVideo.visible=this._recoverType==c.VIDEO,m.isWXMiniGame&&w.isExaminedVersion?w.isExaminedVersion&&(this.btnRecover.visible=!1):this.btnRecover.visible=!0}init(){this.btnRecover.on(Laya.Event.CLICK,this,this.onBtnRecover),this.btnRestart.on(Laya.Event.CLICK,this,this.onBtnRestart),this.btnRank.on(Laya.Event.CLICK,this,this.onBtnRank),this.btnRank.visible=!1}onBtnRecover(){switch(console.log("onBtnRecover"),this._recoverType){case c.NONE:W.instance.recoverCurChildLevel(),Laya.Scene.close(V.SCENE);break;case c.GEM:C.sendEvent(A.BTN_REVIVE_GEM);let e=R.instance.gemNum-n.RECOVER_REQ_GEM_NUM;R.instance.recordGemNum(e),M.instance.event(b.UPDATE_GEM_NUM),W.instance.recoverCurChildLevel(),Laya.Scene.close(V.SCENE),o.fixedDisplay("复活成功");break;case c.SHARE:C.sendEvent(A.BTN_REVIVE_SHARE),w.share(A.SHARE_FOR_REVIVE,r.ShareInfo,this,e=>{e&&0==e.code&&(W.instance.recoverCurChildLevel(),Laya.Scene.close(V.SCENE),C.sendEvent(A.REVIVE_FROM_SHARE))},!0);break;case c.VIDEO:C.sendEvent(A.BTN_REVIVE_VIDEO),w.ads(A.VIDEO_FOR_REVIVE,this,e=>{e&&0==e.code?(W.instance.recoverCurChildLevel(),Laya.Scene.close(V.SCENE),C.sendEvent(A.REVIVE_FROM_VIDEO),o.fixedDisplay("复活成功")):o.fixedDisplay("复活失败了")},!0)}}onBtnRestart(){console.log("onBtnRestart"),C.sendEvent(A.BTN_RESTART),W.instance.resetCurLevel(),Laya.Scene.close(V.SCENE)}onBtnRank(){console.log("onBtnRank"),C.sendEvent(A.BTN_RANK_OF_RECOVER_SCENE),Laya.Scene.open(U.SCENE,!1,V),Laya.Scene.close(V.SCENE)}}V.LOCAL="view/RecoverScene.ts",V.SCENE="RecoverScene.scene",function(e){e[e.NONE=0]="NONE",e[e.GEM=1]="GEM",e[e.SHARE=2]="SHARE",e[e.VIDEO=3]="VIDEO"}(c||(c={}));class H extends e.LevelUpSceneUI{constructor(){super(),this.init()}onEnable(){}onOpened(e=!1){Laya.Tween.from(this,{alpha:.2},300,null,Laya.Handler.create(this,()=>{})),this.setScore(),this.setTotalScore(),this.dealUserInfo(),e&&(this.btnRank.visible=!1,this.setTotalScoreWithProcess()),n.PLAT_SWITCH.SHOW_BANNER_AD_LEVEL_UP_SCENESCENE&&w.showBanner(),n.PLAT_SWITCH.SHOW_INS_AD_LEVEL_UPSCENE&&Math.random()<n.PLAT_SWITCH.SHOW_INS_AD_LEVEL_UPSCENE_RATE&&w.showInterstitialAd()}onClosed(){w.hideBanner(!0)}dealUserInfo(){m.isWXMiniGame&&n.PLAT_SWITCH.IS_CREATE_USERINFO_BUTTON&&(2!=R.instance.levelIndex&&R.instance.levelIndex%5!=0||wx.getSetting({success:e=>{e.authSetting["scope.userInfo"]||(console.log("未曾授权，创建授权按钮"),f.instance.platform.getUserInfo(e=>{console.log("userInfo:",e),e&&this.onBtnNextLvl()}))}}))}init(){this.btnNextLvl.on(Laya.Event.CLICK,this,this.onBtnNextLvl),this.btnRank.on(Laya.Event.CLICK,this,this.onBtnRank),this.btnRank.visible=!1}setScore(){this.txtScore.text="本次得分：{0}".format(R.instance.noCacheData.readyAddScore)}setTotalScore(){this.txtTotalScore.text="游戏总分：{0}".format(R.instance.score)}setStaticTotalScore(){R.instance.recordScoreAndLevels(R.instance.score+R.instance.noCacheData.readyAddScore,R.instance.levelIndex-1),this.txtTotalScore.text="游戏总分：{0}".format(R.instance.score)}setTotalScoreWithProcess(){let e=R.instance.score;this.txtTotalScore.text="游戏总分：{0}".format(e),Laya.timer.once(500,this,()=>{R.instance.recordScoreAndLevels(e+R.instance.noCacheData.readyAddScore,R.instance.levelIndex-1),this.txtTotalScore.num(R.instance.score,300,null,e,"游戏总分：",()=>{})})}onBtnNextLvl(){console.log("onBtnNextLvl"),C.sendEvent(A.BTN_NEXTLVL),W.instance.goToNextLevel(),Laya.Scene.close(H.SCENE)}onBtnRank(){console.log("onBtnRank"),C.sendEvent(A.BTN_RANK_OF_LEVL_UP_SCENE),Laya.Scene.open(U.SCENE,!1,H),Laya.Scene.close(H.SCENE)}}H.LOCAL="view/LevelUpScene.ts",H.SCENE="LevelUpScene.scene",function(e){e[e.Gray=0]="Gray",e[e.Blue=1]="Blue",e[e.Dead=2]="Dead"}(h||(h={})),function(e){e[e.BeforePaint=0]="BeforePaint",e[e.AfterPaint=1]="AfterPaint",e[e.Paint=2]="Paint",e[e.Dead=3]="Dead"}(d||(d={})),function(e){e[e.Prepare=0]="Prepare",e[e.LevelInterval=1]="LevelInterval",e[e.Playing=2]="Playing",e[e.Fail=3]="Fail",e[e.ChildLevelUp=4]="ChildLevelUp",e[e.LevelUp=5]="LevelUp",e[e.AllLevelUp=6]="AllLevelUp"}(_||(_={}));class W{constructor(){this.temoCount=0,this.materialMap=new Object,this.hitMaterials=[],this.bossHitMaterials1=[],this.bossHitMaterials2=[],this.bossHitMaterials3=[]}static get instance(){return W._instance||(W._instance=new W),W._instance}get gameState(){return this._gameState}set gameState(e){this._gameState=e;let t=this._gameState;switch(M.instance.event(b.GAME_STATE,[this._gameState]),t){case _.Prepare:console.log("GameState.Prepare");break;case _.Playing:console.log("GameState.PreparPlayinge");break;case _.Fail:console.log("GameState.GameOver");break;case _.ChildLevelUp:console.log("GameState.ChildLevelUp");break;case _.LevelUp:console.log("GameState.LevelUp");break;case _.AllLevelUp:console.log("GameState.AllLevelUp")}}init(e){this._callBack=e,window.gameCtrl=this;var t=[{url:n.URL_3D_SCENE,type:Laya.Loader.HIERARCHY},{url:n.URL_3D_MAT,type:Laya.Loader.HIERARCHY},{url:n.URL_3D_Cylinder,type:Laya.Loader.HIERARCHY},{url:n.URL_3D_Sector,type:Laya.Loader.HIERARCHY},{url:n.URL_3D_Ball,type:Laya.Loader.HIERARCHY},{url:n.URL_3D_Ball,type:Laya.Loader.HIERARCHY}];let a=[].concat(t);a.push({url:n.URL_LEVEL,type:Laya.Loader.JSON}),Laya.loader.create(a,Laya.Handler.create(this,this.onLoadCompleted)),this.initData(),window.gameCtrl=this,window.MainLogic=f,window.Utils=m,window.GameCtrl=W,window.LevelCtrl=z}initData(){}onLoadCompleted(e){R.instance.init(),window.UserDataCtrl=R,Y.instance.init(),window.Levels=Y,W.instance.gameState=_.Prepare,this.initMaterials(),this.initScene3D(),this.initCamera(),this.initEnemyGroup(),this._callBack&&this._callBack()}initMaterials(){let e=Laya.Loader.getRes(n.URL_3D_MAT);this.materialMap[h.Gray]=e.getChildByName("Gray").meshRenderer.material,this.materialMap[h.Blue]=e.getChildByName("Blue").meshRenderer.material,this.materialMap[h.Dead]=e.getChildByName("Dead").meshRenderer.material;for(let t=0;t<8;t++)this.hitMaterials.push(e.getChildByName("Hit"+(t+1)).meshRenderer.material),this.bossHitMaterials1.push(e.getChildByName("BossHit1-"+(t+1)).meshRenderer.material),this.bossHitMaterials2.push(e.getChildByName("BossHit2-"+(t+1)).meshRenderer.material),this.bossHitMaterials3.push(e.getChildByName("BossHit3-"+(t+1)).meshRenderer.material)}initBG(){let e=new Laya.Image(n.URL_BG0);e.top=e.right=e.bottom=e.left=0,Laya.stage.addChild(e)}initScene3D(){let e=Laya.Loader.getRes(n.URL_3D_SCENE);e.skyRenderer.mesh=null,this.scene=e,Laya.stage.addChild(e),window.scene=this.scene,this._cylinder=Laya.Loader.getRes(n.URL_3D_Cylinder),this._sector=Laya.Loader.getRes(n.URL_3D_Sector),this._ball=Laya.Loader.getRes(n.URL_3D_Ball),this._player=this._ball.getChildByName("Player"),this.playerTargetPoint=this._ball.getChildByName("Target"),window.sector=this._sector;let t=Laya.Loader.getRes(n.URL_3D_Cylinder);window.cylinder=t;let a=t.getChildByName("BallBombEffect");window.ballBombEffect=a;let s=t.getChildByName("CylinderRoot");window.cylinderRoot=s;let i=s.getChildByName("cylinderComplete"),r=s.getChildByName("Dividers"),o=s.getChildByName("RingWaveRoot");i.active=!1,r.active=!1,o.active=!1,window.cylinderComplete=i,window.dividers=r,window.ringWaveRoot=o;let l=t.getChildByName("cylinderSection");window.cylinderSection=l,l.getChildByName("Gem").active=!1}initCamera(){}createPlayer(){let e=this._player.clone();e.meshRenderer.material=z.instance.curChildLvlInfo.colorMat.hit,this.scene.addChild(e),e.addComponent(P),W.instance.gameState=_.Playing}initEnemyGroup(){let e=new Laya.Sprite3D;this.enemyGroup=e,this.scene.addChild(e),e.addComponent(B),this._enemyGroupCtrl=e.getComponent(B),this.initLvl()}setChildLvl(){z.instance.childLevelUp();let e=window.cylinderRoot.clone();this.curCylinderRoot=e,this.enemyGroup.addChild(e);let t=new Laya.Sprite3D;t.name="dividersCylinder",e.addChild(t);let a=window.dividers,s=a.numChildren,n=z.instance.curChildLvlInfo.PaintedNumim,i=null;n>0&&(i=Math.floor(s/n));let r=z.instance.curChildLvlInfo.GemNum,o=null;r>0&&(o=Math.floor(s/r));let l=[];console.log("sectionNum : ",s);for(let e=0;e<s;e++){let s=window.cylinderSection.clone();l.push(s),this.setSectionStatus(s,d.BeforePaint),s.transform.rotation=a.getChildAt(e).transform.rotation,t.addChild(s)}switch(z.instance.curChildLvlInfo.DistributeType){case 1:for(let e=0;e<l.length;e++){let t=l[e];if(i>0&&e%i==0&&this.setSectionStatus(t,d.AfterPaint),o>0&&(s-e-1)%o==0){t.getChildByName("Gem").active=!0}}break;case 2:let e=m.getRandomArrayElements(l,n+r);for(let t=0;t<e.length;t++){let a=e[t];if(n>0)this.setSectionStatus(a,d.AfterPaint),n--;else if(r>0){a.getChildByName("Gem").active=!0,r--}}break;case 3:for(let e=0;e<l.length;e++){let t=l[e];if(n>0)this.setSectionStatus(t,d.AfterPaint),n--;else if(r>0){t.getChildByName("Gem").active=!0,r--}}}let c=t.transform,h=e.getChildByName("cylinderComplete"),u=h.meshRenderer.bounds.getMax().y-h.meshRenderer.bounds.getMin().y;window.singleHeight=u,window.temp=c,c.localPositionY=.03;c.position;W.instance.gameState=_.Playing,this._enemyGroupCtrl.reset(),Laya.Tween.to(c,{localPositionY:u/200},1e3,null,Laya.Handler.create(this,()=>{if(z.instance.curChildLevel>1){e.getChildByName("RingWaveRoot").active=!0}let t=Laya.Ease.backOut;Laya.Tween.to(c,{localPositionY:0},350,t,Laya.Handler.create(this,()=>{this.createPlayer()}));for(let e=0;e<this.enemyGroup.numChildren-1;e++){let a=this.enemyGroup.getChildAt(e).transform;Laya.Tween.to(a,{localPositionY:a.localPositionY-u},350,t,Laya.Handler.create(this,()=>{}))}}))}initLvl(){z.instance.init(),this.resetCurLevel(),x.instance.playBgm(),C.sendEvent(A.INIT_FINISH)}resetCurLevel(){z.instance.curChildLevel=0,this.enemyGroup.destroyChildren(),this.setChildLvl(),console.log("resetCurLevel curLevel = ",z.instance.curLevel)}recoverCurChildLevel(){this.setSectionStatus(this._lastChangedSection,d.AfterPaint),this.createPlayer(),M.instance.event(b.ON_RECOVER)}goToNextLevel(){this.resetCurLevel(),M.instance.event(b.UPDATE_LEVEL)}dealLevelUp(){Laya.timer.once(1300,this,()=>{Laya.Scene.open(H.SCENE,!1,!0),x.instance.playLevelUp()}),z.instance.levelUp()}checkLevelUp(){if(z.instance.checkChildLevelPass()){W.instance.gameState=_.Prepare;let e=z.instance.curChildLvlInfo.isLast;this.dealCylinder2Compl(()=>{e?this.dealLevelUp():this.setChildLvl()})}}setCylinderCompleteAniEndColor(e,t){let a=e.getDefaultState().clip,s=t._shaderValues._data[23],n=a._nodes._nodes,i=n[0]._keyFrames,r=n[1]._keyFrames,o=n[2]._keyFrames,l=n[3]._keyFrames;i[i.length-1].value=s.x,r[r.length-1].value=s.y,o[o.length-1].value=s.z,l[l.length-1].value=s.w}dealCylinder2Compl(e){x.instance.playCircleLayerFinish(),this.curCylinderRoot.getChildByName("dividersCylinder").destroy();let t=this.curCylinderRoot.getChildByName("cylinderComplete"),a=t.getComponent(Laya.Animator),s=z.instance.curChildLvlInfo.colorMat.hit;this.setCylinderCompleteAniEndColor(a,s),t.active=!0;let n=1e3*a.getDefaultState().clip.duration();Laya.timer.once(n,this,()=>{a.enabled=!1,t.meshRenderer&&(t.meshRenderer.material=s)}),t.active=!0,M.instance.event(b.CYLINDER_COMPLETE),e()}dealPaint(){this.checkLevelUp()}dealDead(){console.log("GameCtrl.instance.dealDead"),Laya.Scene.open(V.SCENE,!1)}setSectionStatus(e,t){this._lastChangedSection=e;let a=e.getChildByName("BeforePaint"),s=e.getChildByName("AfterPaint"),n=e.getChildByName("Splat"),i=z.instance.curChildLvlInfo.colorMat.hit;switch(t){case d.BeforePaint:a.active=!0,s.active=!1,n.active=!1;break;case d.Paint:z.instance.curHitCount++,n.getChildByName("SplatQuad").meshRenderer.material.albedoColor=i._shaderValues._data[23],n.active=!0,Laya.timer.once(100,this,()=>{a.active=!1,s.active=!0,n.active=!1,s.meshRenderer.material=i,this.dealPaint()}),z.instance.checkChildLevelPass()||W.instance.createPlayer();break;case d.AfterPaint:a.active=!1,s.active=!0,n.active=!1,s.meshRenderer.material=z.instance.curChildLvlInfo.colorMat.hit;break;case d.Dead:a.active=!1,s.active=!0,n.active=!1,s.meshRenderer.material=z.instance.curChildLvlInfo.colorMat.dead,this.dealDead()}}shakeEnemyGroup(){let e=this.enemyGroup.transform,t=e.position;Laya.Tween.to(e,{localPositionY:t.y+.15},15,Laya.Ease.circIn,Laya.Handler.create(this,()=>{Laya.Tween.to(e,{localPositionY:t.y},15,null,Laya.Handler.create(this,()=>{}))}))}}class F{constructor(e,t,a){this.hit=W.instance.materialMap[h.Blue],this.dead=W.instance.materialMap[h.Dead],this.normal=W.instance.materialMap[h.Gray],e&&(this.hit=e),t&&(this.dead=t),a&&(this.normal=a)}}class k{constructor(e){this.isLast=!1,this.obj=e}get Idx(){return this.obj[0]}get Lvl_ChildLvl(){return this.obj[1]}get Level(){return this.obj[2]}get ChildLvl(){return this.obj[3]}get IsLastChildLvl(){return this.obj[4]}get MatType(){return this.obj[5]}get Aim(){return this.obj[6]}get PaintedNumim(){return this.obj[7]}get GemNum(){return this.obj[8]}get DistributeType(){return this.obj[9]}get colorMat(){if(!this._colorMat){let e;switch(this.MatType){case"hit":e=W.instance.hitMaterials[this.ChildLvl-1];break;case"boss-hit-1":e=W.instance.bossHitMaterials1[this.ChildLvl-1];break;case"boss-hit-2":e=W.instance.bossHitMaterials2[this.ChildLvl-1];break;case"boss-hit-3":e=W.instance.bossHitMaterials3[this.ChildLvl-1]}this._colorMat=new F(e)}return this._colorMat}}class Y{constructor(){this._maxLevel=0}static get instance(){return Y._instance||(Y._instance=new Y),Y._instance}init(){let e=Laya.loader.getRes(n.URL_LEVEL);if(e){this.dataMap=new Map;for(let t in e){let a=new k(e[t]);this.dataMap.set(t,a)}}else console.log("关卡数据配置 获取失败")}getUnit(e){return this.dataMap.get(String(e))}getLevelUnitInfoByLevel(e){if(e<=0||e>this.maxLevel)return null;let t=new X,a=this.dataMap.values();for(let s=0;s<this.dataMap.size;s++){let s=a.next().value;s.Level==e&&(t.childLevels.push(s),t.childLevels.sort(function(e,t){return e.ChildLvl-t.ChildLvl}))}return t.sortChildLevel(),t.childLevelsNum=t.childLevels.length,t.level=e,t}get maxLevel(){if(this._maxLevel>0)return this._maxLevel;let e=this.dataMap.values();for(let t=0;t<this.dataMap.size;t++){let t=e.next().value;t.Level>this._maxLevel&&(this._maxLevel=t.Level)}return this._maxLevel}}class X{constructor(){this.childLevels=[],this.childLevelsNum=0,this.level=0}get isLast(){return this.level==Y.instance.maxLevel}sortChildLevel(){this.childLevels.sort(function(e,t){return e.ChildLvl-t.ChildLvl}),this.childLevels[this.childLevels.length-1].isLast=!0}getChildLevelUnit(e){return e<=0||e>this.childLevelsNum?null:this.childLevels[e-1]}}class z{static get instance(){return z._instance||(z._instance=new z),z._instance}init(){this.curLevel=R.instance.levelIndex}get curHitCount(){return this._curHitCount}set curHitCount(e){this._curHitCount=e}get curChildLevel(){return this._curChildLevel}set curChildLevel(e){this._curChildLevel=e}get curLevel(){return this._curLevel}set curLevel(e){this._curLevel=e}resetData(){this.curHitCount=0}get curLvlInfo(){let e=this.curLevel;return e>Y.instance.maxLevel&&0==(e%=Y.instance.maxLevel)&&(e=Y.instance.maxLevel),Y.instance.getLevelUnitInfoByLevel(e)}get curChildLvlInfo(){return this.curLvlInfo.getChildLevelUnit(this.curChildLevel)}checkChildLevelPass(){return this.curHitCount>=this.curChildLvlInfo.Aim}childLevelUp(){this.curChildLevel&&this.curChildLevel>0?this.curChildLevel+=1:this.curChildLevel=1,z.instance.curHitCount=0,M.instance.event(b.UPDATE_CHILD_LEVEL)}levelUp(){z.instance.curLevel&&z.instance.curLevel>0?z.instance.curLevel+=1:z.instance.curLevel=1,R.instance.recordLevelIndex(z.instance.curLevel)}}class K extends e.GameSceneUI{constructor(){super(),this._ballIcons=[],this.init()}init(){this.initView(),this.rigister(),this.resetBallIcons()}initView(){let e=f.instance.platform.getMenuButtonBoundingClientRect();e&&(e.top>=100?this.boxGem.y=27:this.boxGem.y=e.top+e.height+8),this.setLevelData(),this.setChildLevelData(),this.setGemNumData(),this.setScoreWithProcess(0),this.dealGuide(),this.dealAni()}rigister(){M.instance.on(b.UPDATE_LEVEL,this,this.onLevelUpdated),M.instance.on(b.UPDATE_CHILD_LEVEL,this,this.onChildLevelUpdated),M.instance.on(b.CYLINDER_COMPLETE,this,this.onCylinderComplete),M.instance.on(b.UPDATE_GEM_NUM,this,this.onGemNumUpdated),M.instance.on(b.ON_BALL_SHOOT,this,this.onBallShoot),M.instance.on(b.ON_RECOVER,this,this.onRecover)}dealGuide(){this.boxHandAni.visible=!1,R.instance.isFirstPlay&&this.showGameHandAni()}showGameHandAni(){let e=this.boxHandAni;if(this.boxHandAni.visible=!0,!e.getChildByName("handAni_1")){let t=new Laya.Skeleton;t.name="handAni_1",t.load("res/animation/common/guide.sk",Laya.Handler.create(this,()=>{t.play("animation1",!0)}));let a=1;t.zOrder=10,t.scaleX=a,t.scaleY=a,t.pos(e.width/2,e.height/2),e.addChild(t);let s=new Laya.Skeleton;s.zOrder=11,s.name="handAni_2",s.load("res/animation/common/guide.sk",Laya.Handler.create(this,()=>{s.play("animation2",!0)}));let n=1;s.scaleX=n,s.scaleY=n,s.pos(e.width/2,e.height/2),e.addChild(s)}}hideGameHandAni(){this.boxHandAni.visible&&(R.instance.setIsirstPlay2False(),this.boxHandAni.visible=!1)}dealAni(){let e=new Laya.Tween,t=()=>{e.to(this.imgGem,{rotation:360},3500,null,Laya.Handler.create(this,()=>{this.imgGem.rotation=0,t()}))};t()}setLevelData(){this.txtLevel.text="关卡：{0}".format(z.instance.curLevel),this.setScoreDataZero()}setChildLevelData(){this.txtChildLevel.text="{0}/{1}".format(z.instance.curChildLevel,z.instance.curLvlInfo.childLevelsNum),this.resetBallIcons()}setScoreDataZero(){this.txtScore.text="预计得分：{0}".format(0),this._oldScore=0,R.instance.noCacheData.readyAddScore=0}setGemNumData(){this.txtGemNum.text="x{0}".format(R.instance.gemNum)}setScoreWithProcess(e){let t=this._oldScore+e;R.instance.noCacheData.readyAddScore=t,this.txtScore.num(t,300,null,this._oldScore,"预计得分：",()=>{this._oldScore=t})}setGemWithProcess(e){let t=R.instance.gemNum;this.txtGemNum.num(t,300,null,e,"x",()=>{R.instance.recordGemNum(t)})}showScoreAdd(e){let t,a=Math.min(z.instance.curLevel,n.CYINLINDER_ADD_SCORE_LIMIT),s="+ {0}".format(a),i=new Laya.Image;this.boxScoreAdd.addChild(i),(t=new Laya.Label("x")).text=s,t.fontSize=41,t.color="#FFFFFF",t.bold=!1,t.stroke=4,t.strokeColor="#e8e6a3",i.addChild(t);Laya.timer.once(0,this,()=>{(new Laya.Tween).to(i,{y:i.y-70,alpha:0},800,null,Laya.Handler.create(this,()=>{i.destroy(),this.setScoreWithProcess(a)}))})}showGemUmAdd(e){let t,a=R.instance.gemNum-e,s=new Laya.Image;this.boxGemAdd.addChild(s),(t=new Laya.Label("x")).text="+ {0}".format(a),t.fontSize=41,t.color="#FF0000",t.bold=!1,t.stroke=4,t.strokeColor="#ffffff",s.addChild(t);Laya.timer.once(0,this,()=>{(new Laya.Tween).to(s,{y:s.y-70,alpha:0},800,null,Laya.Handler.create(this,()=>{s.destroy(),this.setGemWithProcess(e)}))})}onLevelUpdated(){this.setLevelData()}onChildLevelUpdated(){this.setChildLevelData()}onCylinderComplete(){this.showScoreAdd(!1),n.PLAT_SWITCH.SHOW_BANNER_AD_GAMESCENE&&(Math.random()<n.PLAT_SWITCH.SHOW_BANNER_AD_GAMESCENE_RATE?w.showBanner():w.hideBanner(!0))}onGemNumUpdated(e,t){e?this.showGemUmAdd(t):this.setGemNumData()}onBallShoot(){let e=this._ballIcons[this._ballIcons.length-1-z.instance.curHitCount];this._lastHideBall=e,e.isBallShow=!1,this.hideGameHandAni()}onRecover(){this._lastHideBall&&(this._lastHideBall.isBallShow=!0)}resetBallIcons(){for(let e of this._ballIcons)e.removeSelf(),Laya.Pool.recover("BALL_ICON",e);this._ballIcons.length=0;let e=z.instance.curChildLvlInfo.Aim;for(let t=0;t<e;t++){let e=Laya.Pool.getItemByClass("BALL_ICON",j);this._ballIcons[t]=e,e.scale(.8,.8),e.isBallShow=!0,e.bottom=50*t,this.boxBall.addChild(e)}}}K.LOCAL="view/GameScene.ts",K.SCENE="GameScene.scene";class j extends Laya.Image{constructor(){super(),this._circle=this.createRing(),this._ball=this.createBall(),this._circle.alpha=.7,this.addChild(this._circle),this.addChild(this._ball)}set isBallShow(e){this._ball.visible=e,e&&this.setImageFilter(this._ball)}createBall(){let e=new Laya.Image;return e.texture=Laya.loader.getRes("comp/img_white_circle.png"),e}setImageFilter(e){let t=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],a=z.instance.curChildLvlInfo.colorMat.hit._shaderValues._data[23];t[0]=a.x,t[5]=a.y,t[10]=a.z,t[15]=a.w;let s=new Laya.ColorFilter(t);e.filters=[s]}createRing(){return new Laya.Image("comp/img_ball_ring.png")}}class J extends e.StartSceneUI{constructor(){super(),this.init(),W.instance.init(()=>{Laya.Scene.open(K.SCENE)}),this.getPlatSwitch()}init(){}getPlatSwitch(){}}class q{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("view/FriendRankScene.ts",U),e("view/GameScene.ts",K),e("view/LevelUpScene.ts",H),e("view/RecoverScene.ts",V),e("view/StartScene.ts",J)}}q.width=720,q.height=1280,q.scaleMode="fixedwidth",q.screenMode="none",q.alignV="top",q.alignH="left",q.startScene="StartScene.scene",q.sceneRoot="",q.debug=!1,q.stat=!1,q.physicsDebug=!1,q.exportSceneToJson=!0,q.init();new class{constructor(){window.Laya3D?Laya3D.init(q.width,q.height):Laya.init(q.width,q.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=q.scaleMode,Laya.stage.screenMode=q.screenMode,Laya.stage.alignV=q.alignV,Laya.stage.alignH=q.alignH,Laya.URL.exportSceneToJson=q.exportSceneToJson,(q.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),q.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),q.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,String.prototype.format||(String.prototype.format=function(){let e=this.toString();if(!arguments.length)return e;let t=typeof arguments[0],a="string"==t||"number"==t?arguments:arguments[0];for(let t in a)e=e.replace(RegExp("\\{"+t+"\\}","gi"),a[t]);return e}),C.sendEvent(A.GAME_VER,{ver:n.VERSION}),C.sendEvent(A.CODE_START),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){f.instance.init()}}}();