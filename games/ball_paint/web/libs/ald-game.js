!function(){if(window&&null==window.wx){wx={},window.wx=wx,wx.getStorageSync=function(e){return window.localStorage.getItem(e)},wx.setStorageSync=function(e,t){return window.localStorage.setItem(e,t)},wx.request=function(e){e.method||(e.method="GET"),e.dataType||(e.dataType="json"),e.responseType||(e.responseType="text");var t=new XMLHttpRequest;if(t.open(e.method,e.url,!0),t.responseType=e.responseType,e.header)for(let n in e.header)t.setRequestHeader(n,e.header[n]);t.onload=function(t){e.success&&e.success(t)},t.ontimeout=function(t){e.success&&e.success(t)},t.fail=function(t){e.success&&e.success(t)},"POST"==e.method?t.send(e.data):t.send()};var n={query:{},referrerInfo:{},scene:1e3,shareTicket:null};window.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState?(wx.cbShow&&wx.cbShow(n),console.log("前台")):"hidden"===document.visibilityState&&(wx.cbHide&&wx.cbHide(),console.log("后台"))}),wx.getLaunchOptionsSync=function(){return n},wx.onShow=function(e){wx.cbShow=e},wx.onHide=function(e){wx.cbHide=e},wx.onError=function(e){},wx.getSetting=function(e){},wx.getNetworkType=function(e){}}if("object"==typeof __wxConfig){if("devtools"==wx.getSystemInfoSync().platform)ald_game_conf.app_key=ald_game_conf.app_key_test;else switch(__wxConfig.envVersion){case"develop":case"trial":ald_game_conf.app_key=ald_game_conf.app_key_test;break;case"release":ald_game_conf.app_key=ald_game_conf.app_key_release}console.log("ald_game_conf.app_key: "+ald_game_conf.app_key)}function t(){var e="";try{e=wx.getStorageSync("aldstat_op")}catch(t){e=wx.getStorageSync("aldstat_op")}if(""===e){if(""===i)return"";try{v=e=wx.getStorageSync(i),e&&wx.setStorageSync("aldstat_op",e)}catch(t){v=e=wx.getStorageSync(i),e&&wx.setStorageSync("aldstat_op",e)}}return e}function c(e){var t={};return"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(e,n){t["[object "+e+"]"]=e.toLowerCase()}),null==e?e:"object"==typeof e||"function"==typeof e?t[function(e){return Object.prototype.toString.call(e)}.call(e)]||"object":typeof e}function d(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()}function m(e,n){function a(){return new Promise(function(t,n){wx.request({url:"https://"+r+".aldwx.com/d.html",data:e,header:{se:w||"",op:v||"",img:k||""},method:"GET",fail:function(){t("")},success:function(e){t(200==e.statusCode?"":"status error")}})})}o.useOpen&&t(),_++,e.as=q,e.at=I,e.rq_c=_,e.ifo=l,e.ak=o.app_key,e.uu=p,e.v=s,e.st=Date.now(),e.ev=n,e.te=u,e.wsr=S,""!==function(e){if(void 0===e||""===e)return"";var t={};for(var n in e)"rawData"!=n&&"errMsg"!=n&&(t[n]=e[n]);return t}(e.ufo)&&(e.ufo=e.ufo),e.ec=y,o.useOpen?""===v?(console.error("OpenID未能正确上传！开启了useOpen配置项后，必须在代码里上传OpenID，上传方式：http://doc.aldwx.com 小游戏统计/广告监测平台-快速接入指南-上传OpenID！"),L.push(a)):(wx.Queue.push(a),L.concat()):wx.Queue.push(a)}function f(e){var t={};for(var n in e)t[n]=e[n];return t}function h(e){for(var t="",n=0;n<e.length;n++)e[n].length>t.length&&(t=e[n]);return t}var s="3.2.0",r="glog",o=window.ald_game_conf;""===o.app_key&&console.error("请在ald-game-conf.js文件中填写小游戏统计/广告监测平台创建小游戏后生成的app_key，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南！"),o.app_key=o.app_key.replace(/\s/g,"");var i=o.openKey,u="wg";wx.request({url:"https://"+r+".aldwx.com/config/app.json",method:"GET",success:function(e){200===e.statusCode&&(e.data.version>s&&console.warn("您的SDK不是最新版本，部分功能不可用，请尽快前往 http://tj.aldwx.com/downSDK 升级"),e.data.warn&&console.warn(e.data.warn),e.data.error&&console.error(e.data.error))}});var l="",p=function(){var e="";try{e=wx.getStorageSync("aldstat_uuid"),wx.setStorageSync("ald_ifo",!0)}catch(t){e="uuid_getstoragesync"}if(e)l=!1;else{e=d(),l=!0;try{wx.setStorageSync("aldstat_uuid",e)}catch(e){wx.setStorageSync("aldstat_uuid","uuid_getstoragesync")}}return e}(),g={},w="",v=t(),y=0,_="",S=wx.getLaunchOptionsSync(),x=Date.now(),I=""+Date.now()+Math.floor(1e7*Math.random()),q=""+Date.now()+Math.floor(1e7*Math.random()),b=0,N="",k="",O=!0,j=!1,M=["aldSendEvent","aldOnShareAppMessage","aldShareAppMessage","aldSendSession","aldSendOpenid","aldLevelEvent"],D=["payStart","paySuccess","payFail","die","revive","tools","award"],P=["complete","fail"],T=wx.getStorageSync("ald_level_time")||0,C=wx.getStorageSync("ald_level_session")||"";void 0===wx.Queue&&(wx.Queue=new function(){this.concurrency=4,this.queue=[],this.tasks=[],this.activeCount=0;var e=this;this.push=function(t){this.tasks.push(new Promise(function(n,a){var s=function(){e.activeCount++,t().then(function(e){n(e)}).then(function(){e.next()})};e.activeCount<e.concurrency?s():e.queue.push(s)}))},this.all=function(){return Promise.all(this.tasks)},this.next=function(){e.activeCount--,e.queue.length>0&&e.queue.shift()()}},wx.Queue.all());var L=new function(){this.request=[],this.push=function(e){this.request.length>=18?(this.request.shift(),this.request.push(e)):this.request.push(e)},this.concat=function(){this.request.map(function(e){wx.Queue.push(e)}),this.request=[]}};Promise.all([new Promise(function(e,t){wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(t){k=h(t.userInfo.avatarUrl.split("/")),e(t)},fail:function(){e("")}}):e("")},fail:function(){e("")}})}),new Promise(function(e,t){wx.getNetworkType({success:function(t){e(t)},fail:function(){e("")}})}),new Promise(function(e,t){o.getLocation?wx.getLocation({success:function(t){e(t)},fail:function(){e("")}}):wx.getSetting({success:function(t){t.authSetting["scope.userLocation"]?(wx.getLocation({success:function(t){e(t)},fail:function(){e("")}}),e("")):e("")},fail:function(){e("")}})})]).then(function(e){""!==e[2]?(g.lat=e[2].latitude||"",g.lng=e[2].longitude||"",g.spd=e[2].speed||""):(g.lat="",g.lng="",g.spd=""),""!==e[1]?g.nt=e[1].networkType||"":g.nt="";var t=f(g);""!==e[0]&&(t.ufo=e[0],N=e[0]),m(t,"init")}),wx.onShow(function(e){if(S=e,b=Date.now(),!O&&!j){I=""+Date.now()+Math.floor(1e7*Math.random()),l=!1;try{wx.setStorageSync("ald_ifo",!1)}catch(e){}}O=!1,j=!1;var t=f(g),n=f(g);t.sm=b-x,e.query.ald_share_src&&e.shareTicket&&"1044"===e.scene?(n.tp="ald_share_click",new Promise(function(e,t){"1044"==S.scene?wx.getShareInfo({shareTicket:S.shareTicket,success:function(t){e(t)},fail:function(){e("")}}):e("")}).then(function(e){n.ct=e,m(n,"event")})):e.query.ald_share_src&&(n.tp="ald_share_click",n.ct="1",m(n,"event")),m(t,"show")}),wx.onHide(function(){wx.setStorageSync("ald_level_session","");var e=f(g);e.dr=Date.now()-b,""===N?wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(t){e.ufo=t,N=t,k=h(t.userInfo.avatarUrl.split("/")),m(e,"hide")}}):m(e,"hide")}}):m(e,"hide")}),wx.onError(function(e){var t=f(g);t.tp="ald_error_message",t.ct=e,y++,m(t,"event")});var E={aldSendEvent:function(e,t){var n=f(g);if(""!==e&&"string"==typeof e&&e.length<=255)if(n.tp=e,"string"==typeof t&&t.length<=255)n.ct=String(t),m(n,"event");else if("object"==typeof t){if(JSON.stringify(t).length>=255)return void console.error("自定义事件参数不能超过255个字符，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-自定义事件！");if(function(e){for(var t in e)if("object"==typeof e[t]&&null!==e[t])return!0;return!1}(t))return void console.error("事件参数内部只支持Number、String等类型，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-自定义事件！");for(var a in t)"number"==typeof t[a]&&(t[a]=t[a]+"s##");n.ct=JSON.stringify(t),m(n,"event")}else void 0===t||""===t?m(n,"event"):console.error("事件参数必须为String、Object类型，且参数长度不能超过255个字符，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-自定义事件！");else console.error("事件名称必须为String类型且不能超过255个字符，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-自定义事件！")},aldOnShareAppMessage:function(e){wx.onShareAppMessage(function(){j=!0;var t=e(),n="";n=void 0!==S.query.ald_share_src?void 0!==t.query?(S.query.ald_share_src.indexOf(p),t.query+"&ald_share_src="+S.query.ald_share_src+","+p):(S.query.ald_share_src.indexOf(p),"ald_share_src="+S.query.ald_share_src+","+p):void 0!==t.query?t.query+"&ald_share_src="+p:"ald_share_src="+p,"undefined"!=c(t.ald_desc)&&(n+="&ald_desc="+t.ald_desc),t.query=n;var a=f(g);return a.ct=t,a.ct.sho=1,a.tp="ald_share_chain",m(a,"event"),t})},aldShareAppMessage:function(e){j=!0;var t=e,n="";n=void 0!==S.query.ald_share_src?void 0!==t.query?(S.query.ald_share_src.indexOf(p),t.query+"&ald_share_src="+S.query.ald_share_src+","+p):(S.query.ald_share_src.indexOf(p),"ald_share_src="+S.query.ald_share_src+","+p):void 0!==t.query?t.query+"&ald_share_src="+p:"ald_share_src="+p;var a=f(g);"undefined"!=c(t.ald_desc)&&(n+="&ald_desc="+t.ald_desc),t.query=n,a.ct=t,a.tp="ald_share_chain",m(a,"event"),wx.shareAppMessage(t)},aldSendSession:function(e){if(""!==e&&e){var t=f(g);t.tp="session",t.ct="session",w=e,""===N?wx.getSetting({success:function(e){e.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(e){t.ufo=e,m(t,"event")}}):m(t,"event")}}):(t.ufo=N,""!==N&&(t.gid=""),m(t,"event"))}else console.error("请传入从后台获取的session_key")},aldSendOpenid:function(e){if(""!==e&&e){v=e,wx.setStorageSync("aldstat_op","openid");var t=f(g);t.tp="openid",t.ct="openid",m(t,"event")}else console.error("OpenID不符合规则，请参考接入文档 http://doc.aldwx.com 小游戏统计/广告监测平台-快速接入指南！")}};wx.aldStage=new function(){function e(e){return!/^\d+(.\d+)*$/.test(e.stageId)||e.stageId.length>32||isNaN(Number(e.stageId))?(console.error("关卡stageId必须符合传参规则，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-关卡分析！"),!1):!("string"!==c(e.stageName)||e.stageName.length>32)||(console.error("关卡名称为必传字段，且长度小于32个字符，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-关卡分析！"),!1)}var t="",n="",a=0;this.onStart=function(s){if(e(s)){var r={};a=Date.now(),r.sid=s.stageId,r.snm=s.stageName,("string"===c(s.userId)&&s.userId)<32?r.uid=s.userId:r.uid="",r.state="start",n=d(),t=r,this.request()}},this.onRunning=function(n){if(e(n)){var a={params:{}};if(("string"===c(n.userId)&&n.userId)<32?a.uid=n.userId:a.uid="",""===n.event||"string"!==c(n.event)||-1===D.join(",").indexOf(n.event+","))return void console.error("关卡running状态中仅支持"+D.join(",")+"事件类型，且为必传字段，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-关卡分析！");if(a.event=n.event,"object"!==c(n.params))return void console.error("关卡running状态中params为必传字段，且该字段需为Object类型，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-关卡分析！");if("string"!==c(n.params.itemName)||n.params.itemName.length>32)return void console.error("道具/商品名称为必传字段，且长度小于32个字符，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-关卡分析！");a.params.itnm=n.params.itemName,"string"===c(n.params.itemId)&&n.params.itemId.length<32&&(a.params.itid=n.params.itemId),"number"===c(n.params.itemCount)&&String(n.params.itemCount).length<32?a.params.itco=n.params.itemCount:n.params.itemCount?(console.error("关卡running状态中params.itemCount必须符合传参规则，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-关卡分析！"),a.params.itco=1):(console.info("关卡running状态中params.itemCount为选填项，请再次确认该项是否填写，如已确认，请忽略"),a.params.itco=1),-1!==n.event.indexOf("pay")&&("number"===c(n.params.itemMoney)&&String(n.params.itemMoney).length<32?a.params.money=n.params.itemMoney:n.params.itemMoney?(console.error("关卡running状态中params.itemMoney必须符合传参规则，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-关卡分析！"),a.params.money=0):(console.info("关卡running状态中params.itemMoney为选填项，请再次确认该项是否填写，如已确认，请忽略"),a.params.money=0)),"string"===c(n.params.desc)&&n.params.desc.length<64&&(a.params.desc=n.params.desc),a.state="running",a.sid=n.stageId,a.snm=n.stageName,t=a,this.request()}},this.onEnd=function(n){if(e(n)){var s={state:"end"};if(("string"===c(n.userId)&&n.userId)<32?s.uid=n.userId:s.uid="",""===n.event||"string"!==c(n.event)||-1===P.join(",").indexOf(n.event+","))return void console.error("关卡end状态中仅支持"+P.join(",")+"事件类型，且为必传字段，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-关卡分析！");s.sid=n.stageId,s.snm=n.stageName,s.event=n.event,s.sdr=0!==a?Date.now()-a:"",s.params={},"object"===c(n.params)&&"string"===c(n.params.desc)&&n.params.desc.length<64&&(s.params.desc=n.params.desc),t=s,this.request()}},this.request=function(){var e=f(g);t.ss=n,e.ct=t,m(e,"screen")}},wx.aldLevel=new function(){function e(e){return!/^\d+(.\d+)*$/.test(e.levelId)||e.levelId.length>32||isNaN(Number(e.levelId))?(console.error("levelId必须符合传参规则，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-等级分析！"),!1):!("string"!==c(e.levelName)||e.levelName.length>32)||(console.error("levelName为必传字段，且长度小于32个字符，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-等级分析！"),!1)}var t="",n="",a=0;this.onInitLevel=function(a){if(e(a)){var s={};""==C?(n=d(),wx.setStorageSync("ald_level_session",n)):n=C,s.lid=a.levelId,s.lnm=a.levelName,("string"===c(a.userId)&&a.userId)<32?s.uid=a.userId:s.uid="",s.un=a.userName,s.state="init",t=s,this.request()}},this.onSetLevel=function(s){if(e(s)){var r={};n=d(),wx.setStorageSync("ald_level_session",n),r.lid=s.levelId,r.lnm=s.levelName,("string"===c(s.userId)&&s.userId)<32?r.uid=s.userId:r.uid="",r.un=s.userName,r.state="set",r.tmr=0!==T?Date.now()-T:"",a=Date.now(),wx.setStorageSync("ald_level_time",a),t=r,this.request()}},this.onPaySuccess=function(n){if(e(n)){var a={params:{}};if("object"!==c(n.params))return void console.error("等级onPaySuccess事件中params为必传字段，且该字段需为Object类型，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-等级分析！");"number"===c(n.params.amount)&&String(n.params.amount).length<32?a.params.am=n.params.amount:n.params.amount?(console.error("等级onPaySuccess事件中params.amount必须符合传参规则，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-等级分析！"),a.params.am=0):(console.info("等级onPaySuccess事件中params.amount为选填项，请再次确认该项是否填写，如已确认，请忽略"),a.params.am=0),"string"===c(n.params.desc)&&n.params.desc.length<64&&(a.params.desc=n.params.desc),a.lid=n.levelId,a.lnm=n.levelName,("string"===c(n.userId)&&n.userId)<32?a.uid=n.userId:a.uid="",a.un=n.userName,a.state="paySuccess",t=a,this.request()}},this.onPayFail=function(n){if(e(n)){var a={params:{}};if("object"!==c(n.params))return void console.error("等级onPayFail事件中params为必传字段，且该字段需为Object类型，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-等级分析！");"number"===c(n.params.amount)&&String(n.params.amount).length<32?a.params.am=n.params.amount:n.params.amount?(console.error("等级onPayFail事件中params.amount必须符合传参规则，请参考接入文档 http://doc.aldwx.com 小游戏统计平台-快速接入指南-等级分析！"),a.params.am=0):(console.info("等级onPayFail事件中params.amount为选填项，请再次确认该项是否填写，如已确认，请忽略"),a.params.am=0),"string"===c(n.params.desc)&&n.params.desc.length<64&&(a.params.desc=n.params.desc),a.lid=n.levelId,a.lnm=n.levelName,("string"===c(n.userId)&&n.userId)<32?a.uid=n.userId:a.uid="",a.un=n.userName,a.state="payFail",t=a,this.request()}},this.request=function(){var e=f(g);t.ls=n,e.ct=t,m(e,"level")}};for(var H=0;H<M.length;H++)!function(e,t){Object.defineProperty(wx,e,{value:t,writable:!1,enumerable:!0,configurable:!0})}(M[H],E[M[H]]);try{var A=wx.getSystemInfoSync();g.br=A.brand||"",g.md=A.model,g.pr=A.pixelRatio,g.sw=A.screenWidth,g.sh=A.screenHeight,g.ww=A.windowWidth,g.wh=A.windowHeight,g.lang=A.language,g.wv=A.version,g.sv=A.system,g.wvv=A.platform,g.fs=A.fontSizeSetting,g.wsdk=A.SDKVersion,g.bh=A.benchmarkLevel||"",g.bt=A.battery||"",g.wf=A.wifiSignal||"",g.lng="",g.lat="",g.nt="",g.spd="",g.ufo=""}catch(e){}}();