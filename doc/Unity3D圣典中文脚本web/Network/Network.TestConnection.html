<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; " />
<title>Network.TestConnection 测试连接</title>
<meta name="Keywords" content="unity,Network,TestConnection,测试连接" />
<meta name="Description" content="测试这台机器的网络连接。" />
<link href="../Style/CSS/UnityStyle.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../Style/SJ/jquery.min.js"></script>
<script type="text/javascript" src="../Style/SJ/tabs.min.js"></script>
  <script type="text/javascript">
$(function() {
	$("ul.tabs").tabs("> .panes", {initialIndex: 1});
});
</script>

</head>

<body>
<div class="head">
<div class="logo"><a href="/Script"><img src="../Style/Images/unitylogo.png" alt="Unity圣典" width="350" height="80"  title="Unity圣典"/></a></div>
<div class="menu"><a href="/">首页</a><a href="/Script">Unity脚本</a></div>
</div>

<div class="mainbody">
<div class="leftmain">
    	        <ul class="scriptmenu">
          <li><a href="../index.html">Overview</a> <span class="trans">概述</span></li>
            <li><a href="../Runtime.Classes.html">Runtime Classes</a> <span class="trans">实时运行类</span></li>
            <ul>
                <li><a href="../Attributes/Attributes.html">Attributes</a> <span class="trans">属性</span></li>
                <li><a href="../Enumerations/Enumerations.html">Enumerations</a> <span class="trans">枚举</span></li>
            </ul>
            <li><a href="../Editor.Classes.html">Editor Classes</a> <span class="trans">编辑器类</span></li>
            <ul>
                <li><a href="../Editor_Enumerations/Editor.Enumerations.html">Enumerations</a> <span class="trans">枚举</span></li>
            </ul>
            <li>History <span class="trans">历史</span></li>
            <li><a href="../index.Classes.html">Index</a> <span class="trans">总索引</span></li>
        </ul>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-8054246454688368";
/* Unity方 */
google_ad_slot = "5047319569";
google_ad_width = 200;
google_ad_height = 200;
//-->
</script>
<script type="text/javascript"
src="">
</script>
        <div class="subclass"><a href="Network.html">Network</a><span class="transer">翻译：U_鹰 </span>
                <ul>
                    <li><a href="Network.AllocateViewID.html">AllocateViewID</a></li>
                    <li><a href="Network.CloseConnection.html">CloseConnection</a></li>
                    <li><a href="Network.connections.html">connections</a></li>
                    <li><a href="Network.connectionTesterIP.html">connectionTesterIP</a></li>
                    <li><a href="Network.connectionTesterPort.html">connectionTesterPort</a></li>
                    <li><a href="Network.Connect.html">Connect</a></li>
                    <li><a href="Network.DestroyPlayerObjects.html">DestroyPlayerObjects</a></li>
                    <li><a href="Network.Destroy.html">Destroy</a></li>
                    <li><a href="Network.Disconnect.html">Disconnect</a></li>
                    <li><a href="Network.GetAveragePing.html">GetAveragePing</a></li>
                    <li><a href="Network.GetLastPing.html">GetLastPing</a></li>
                    <li><a href="Network.HavePublicAddress.html">HavePublicAddress</a></li>
                    <li><a href="Network.incomingPassword.html">incomingPassword</a></li>
                    <li><a href="Network.InitializeSecurity.html">InitializeSecurity</a></li>
                    <li><a href="Network.InitializeServer.html">InitializeServer</a></li>
                    <li><a href="Network.Instantiate.html">Instantiate</a></li>
                    <li><a href="Network.isClient.html">isClient</a></li>
                    <li><a href="Network.isMessageQueueRunning.html">isMessageQueueRunning</a></li>
                    <li><a href="Network.isServer.html">isServer</a></li>
                    <li><a href="Network.logLevel.html">logLevel</a></li>
                    <li><a href="Network.maxConnections.html">maxConnections</a></li>
                    <li><a href="Network.minimumAllocatableViewIDs.html">minimumAllocatableViewIDs</a></li>
                    <li><a href="Network.natFacilitatorIP.html">natFacilitatorIP</a></li>
                    <li><a href="Network.natFacilitatorPort.html">natFacilitatorPort</a></li>
                    <li><a href="Network.OnConnectedToServer.html">OnConnectedToServer</a></li>
                    <li><a href="Network.OnDisconnectedFromServer.html">OnDisconnectedFromServer</a></li>
                    <li><a href="Network.OnFailedToConnectToMasterServer.html" title="OnFailedToConnectToMasterServer">OnFailedToConnectToM...</a></li>
                    <li><a href="Network.OnFailedToConnect.html">OnFailedToConnect</a></li>
                    <li><a href="Network.OnNetworkInstantiate.html">OnNetworkInstantiate</a></li>
                    <li><a href="Network.OnPlayerConnected.html">OnPlayerConnected</a></li>
                    <li><a href="Network.OnPlayerDisconnected.html">OnPlayerDisconnected</a></li>
                    <li><a href="Network.OnSerializeNetworkView.html">OnSerializeNetworkView</a></li>
                    <li><a href="Network.OnServerInitialized.html">OnServerInitialized</a></li>
                    <li><a href="Network.peerType.html">peerType</a></li>
                    <li><a href="Network.player.html">player</a></li>
                    <li><a href="Network.proxyIP.html">proxyIP</a></li>
                    <li><a href="Network.proxyPassword.html">proxyPassword</a></li>
                    <li><a href="Network.proxyPort.html">proxyPort</a></li>
                    <li><a href="Network.RemoveRPCsInGroup.html">RemoveRPCsInGroup</a></li>
                    <li><a href="Network.RemoveRPCs.html">RemoveRPCs</a></li>
                    <li><a href="Network.sendRate.html">sendRate</a></li>
                    <li><a href="Network.SetLevelPrefix.html">SetLevelPrefix</a></li>
                    <li><a href="Network.SetReceivingEnabled.html">SetReceivingEnabled</a></li>
                    <li><a href="Network.SetSendingEnabled.html">SetSendingEnabled</a></li>
                    <li><a href="Network.TestConnectionNAT.html">TestConnectionNAT</a></li>
                    <li><a href="Network.TestConnection.html">TestConnection</a></li>
                    <li><a href="Network.time.html">time</a></li>
                    <li><a href="Network.useProxy.html">useProxy</a></li>
                </ul>
</div>
    </div>
    <div class="rightmain"><!--right start--><script type="text/javascript"><!--
google_ad_client = "ca-pub-8054246454688368";
/* Unity横 */
google_ad_slot = "2374072180";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="">
</script>
<h1><a href="Network.html">Network</a>.TestConnection 测试连接</h1>
<p class="h1inherit"></p>
<p>static function <em>TestConnection</em> (<em>forceTest</em> : bool = false) : <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.html">ConnectionTesterStatus</a></p>
<p><em>Description</em><span class="trans">描述</span></p>
<p> Test this machines network connection. </p>
<p>测试这台机器的网络连接。</p>
<p> Two types of tests are performed depending on if   the machine has a public IP address present or if it only has a private   address (or addresses). </p>
<p>测试执行两种测试，这取决机器是公网IP还是一个私有IP。</p>
<p> The public IP address test is primarily for when running a server as no   tests are needed for clients with public addresses. In order  for the public IP test to succeed a server instance must be started. A   test server will try to connect to the  IP and port of the local server and thus it is shown in the server is   connectable. If not then a firewall is most likely  blocking the server port. A server instance needs to be running so that   the test server has something to connect  to. </p>
<p>公网IP测试主要用于服务器，不需要测试具有公网IP的客户端。为了公网IP测试成功，必须开启一个服务器实例。一个测试服务器将尝试连接到本地服务器的IP地址和端口，因此它被显示在服务器中是可连接状态。如果不是，那么防火墙是最有可能阻断服务端口的。服务器实例需要运行以便测试服务器已经连接。</p>
<p> The other test is for checking NAT punchthrough capabilities. This is a valid test for both servers and clients  and can be performed without any prior setup. If the NAT test fails for a server then it is a bad idea to proceed  without setting up port forwarding as no client outside the local LAN network will be able to connect. If the test fails  for a client then it cannot connect to servers with NAT addresses, those kinds of servers should then not be be presented  to the user as possible game hosts. </p>
<p>另一个测试检测NAT穿透能力。服务器和客户端都可以进行，无需任何事先设定。如果用于服务器NAT测试失败，那么不设置端口转发是一个坏主意。本地LAN网络之外的客户端将不能连接。如果测试失败，客户端就不能使用NAT穿透连接到服务器，这些服务器将不会提供给用户作为主机。</p>
<p> This function is asynchronous and might not return a valid result right away because the tests needs  some time to complete (1-2 seconds). After test completion the test result is only returned when the function is called again,   a full network test is not redone. That way it is safe to poll the function frequently. If another test is desired,   like if the network connection has been altered, then the forceTest parameter should be passed as true. </p>
<p>这个函数是异步的，并可能不会返回有效的结果。因为这个测试需要一些时间来完成（1-2秒）。测试完成之后，测试结果只在函数被再次调用时返回。这样，频繁访问该函数是安全的。如果需要其他的测试，如网络连接已更改，那么forcTest参数应该为true。</p>
<p> The function returns a <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.html">ConnectionTesterStatus</a> enum.</p>
<p>该函数返回一个<a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.html">ConnectionTesterStatus</a>枚举。</p>
<div class="note"><pre><code>var testStatus = &quot;Testing network connection capabilities.&quot;;
var testMessage = &quot;Test in progress&quot;;
var shouldEnableNatMessage : String = &quot;&quot;;
var doneTesting = false;
var probingPublicIP = false;
var serverPort = 9999;
var connectionTestResult = ConnectionTesterStatus.Undetermined;

<span class="notes">// Indicates if the useNat parameter be enabled when starting a server
//表示在服务器启动时，useNat参数是否启用</span>
var useNat = false;

function OnGUI() {
	<a href="../GUILayout/GUILayout.Label.html">GUILayout.Label</a>(&quot;Current Status: &quot; + testStatus);
	<a href="../GUILayout/GUILayout.Label.html">GUILayout.Label</a>(&quot;Test result : &quot; + testMessage);
	<a href="../GUILayout/GUILayout.Label.html">GUILayout.Label</a>(shouldEnableNatMessage);
	if (!doneTesting)
		TestConnection();
}

function TestConnection() {
	<span class="notes">// Start/Poll the connection test, report the results in a label and
	// react to the results accordingly
	//开始/轮询连接测试，在标签上显示结果并按照结果做出相应的反应</span>
	connectionTestResult = <a href="Network.TestConnection.html">Network.TestConnection</a>();
	switch (connectionTestResult) {
		case <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.Error.html">ConnectionTesterStatus.Error</a>:
			testMessage = &quot;Problem determining NAT capabilities&quot;;
			doneTesting = true;
			break;

		case <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.Undetermined.html">ConnectionTesterStatus.Undetermined</a>:
			testMessage = &quot;Undetermined NAT capabilities&quot;;
			doneTesting = false;
			break;

		case <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.PublicIPIsConnectable.html">ConnectionTesterStatus.PublicIPIsConnectable</a>:
			testMessage = &quot;Directly connectable public IP address.&quot;;
			useNat = false;
			doneTesting = true;
			break;

		<span class="notes">// This case is a bit special as we now need to check if we can
		// circumvent the blocking by using NAT punchthrough
		//这是一个比较特殊的情况，现在需要检查，如果我们可以使用NAT穿透规避阻塞</span>
		case <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.PublicIPPortBlocked.html">ConnectionTesterStatus.PublicIPPortBlocked</a>:
			testMessage = &quot;Non-connectble public IP address (port &quot; +
			serverPort +&quot; blocked), running a server is impossible.&quot;;
			useNat = false;
		<span class="notes">// If no NAT punchthrough test has been performed on this public
		// IP, force a test
		//在这个公网IP，如果没有NAT穿透测试被执行，强制测试</span>
		if (!probingPublicIP) {
			connectionTestResult = <a href="Network.TestConnectionNAT.html">Network.TestConnectionNAT</a>();
			probingPublicIP = true;
			testStatus = &quot;Testing if blocked public IP can be circumvented&quot;;
			timer = Time.time + 10;
		}
		<span class="notes">// NAT punchthrough test was performed but we still get blocked
		//NAT穿透测试已经执行，但是我们仍然被阻塞</span>
		else if (<a href="../Time/Time.time.html">Time.time</a> &gt; timer) {
			probingPublicIP = false; <span class="notes">// reset 重置</span>
			useNat = true;
			doneTesting = true;
		}
		break;
		case <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.PublicIPNoServerStarted.html">ConnectionTesterStatus.PublicIPNoServerStarted</a>:
			testMessage = &quot;Public IP address but server not initialized, &quot;+
				&quot;it must be started to check server accessibility. Restart &quot;+
				&quot;connection test when ready.&quot;;
			break;

		case <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.LimitedNATPunchthroughPortRestricted.html">ConnectionTesterStatus.LimitedNATPunchthroughPortRestricted</a>:
			testMessage = &quot;Limited NAT punchthrough capabilities. Cannot &quot;+
				&quot;connect to all types of NAT servers.&quot;;
				useNat = true;
			doneTesting = true;
			break;

		case <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.LimitedNATPunchthroughPortRestricted.html">ConnectionTesterStatus.LimitedNATPunchthroughPortRestricted</a>:
			testMessage = &quot;Limited NAT punchthrough capabilities. Cannot &quot;+
				&quot;connect to all types of NAT servers. Running a server &quot;+
				&quot;is ill advised as not everyone can connect.&quot;;
			useNat = true;
			doneTesting = true;
			break;

		case <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.LimitedNATPunchthroughSymmetric.html">ConnectionTesterStatus.LimitedNATPunchthroughSymmetric</a>:
			testMessage = &quot;Limited NAT punchthrough capabilities. Cannot &quot;+
				&quot;connect to all types of NAT servers. Running a server &quot;+
				&quot;is ill advised as not everyone can connect.&quot;;
			useNat = true;
			doneTesting = true;
			break;

		case <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.NATpunchthroughAddressRestrictedCone.html">ConnectionTesterStatus.NATpunchthroughAddressRestrictedCone</a>:
		case <a href="../Enumerations/ConnectionTesterStatus/ConnectionTesterStatus.NATpunchthroughFullCone.html">ConnectionTesterStatus.NATpunchthroughFullCone</a>:
			testMessage = &quot;NAT punchthrough capable. Can connect to all &quot;+
				&quot;servers and receive connections from all clients. Enabling &quot;+
				&quot;NAT punchthrough functionality.&quot;;
			useNat = true;
			doneTesting = true;
			break;

		default:
			testMessage = &quot;Error in test routine, got &quot; + connectionTestResult;
	}
	if (doneTesting) {
		if (useNat)
			shouldEnableNatMessage = &quot;When starting a server the NAT &quot;+
				&quot;punchthrough feature should be enabled (useNat parameter)&quot;;
		else
			shouldEnableNatMessage = &quot;NAT punchthrough not needed&quot;;
				testStatus = &quot;Done testing&quot;;
	}
}</code></pre></div>
<div class="date"><span>最后修改：<!-- #BeginDate format:wfcCh2m -->2011年4月4日 Monday  17:49<!-- #EndDate --></span></div><script type="text/javascript"><!--
google_ad_client = "ca-pub-8054246454688368";
/* Unity横 */
google_ad_slot = "2374072180";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="">
</script>
<!--right end--></div>
    <div class="clear"></div>
</div>

<div style="padding: 30px; text-align: center; clear:both"><p>本脚本参考基于Unity 3.30f4</p>英文部分版权属&copy;<a href="http://unity3d.com/">Unity</a>公司所有，中文部分&copy;
<a href="http://3d.ceeger.com/">Unity圣典</a> 版权所有，未经许可，严禁转载 。</div>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fce93455bb2ae8f76d8b4a8d07db27a24' type='text/javascript'%3E%3C/script%3E"));
</script>

</body>
</html>
